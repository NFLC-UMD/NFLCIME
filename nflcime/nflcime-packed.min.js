var NFLCIME=NFLCIME||{};NFLCIME.extend=function(a,b){var c,d,e,f,g=arguments;for(a=a||this,c=1,d=g.length;d>c;c++){b=g[c];for(e in b)b.hasOwnProperty(e)&&(f=b[e],void 0!==f&&(a[e]=f))}return a},NFLCIME.extend(NFLCIME,{addEventListener:function(a,b,c){var d=a+(c?"_cap":""),e=this.eventListenerHash[d];e||(this.eventListenerHash[d]=e=[]),e.push(b)},removeEventListener:function(a,b,c){var d=a+(c?"_cap":""),e=this.eventListenerHash[d];if(e){for(var f=e.length-1;f>=0;f--)e[f]==b&&e.splice(f,1);0==e.length&&(this.eventListenerHash[d]=void 0)}},dispatchEvent:function(a){for(var b,c=["_cap",""],d=0;d<c.length;d++){var e=a.type+c[d],f=this.eventListenerHash[e];if(f){f=f.concat();for(var g=0;g<f.length;g++){var h=f[g],i=h["on"+a.type];if(i&&(b=i.call(h,a)),void 0!=b)return b}}}},onWindowListen:function(a){var b=a.target;switch(this.environment.browser){case"firefox":case"safari":b.addEventListener("mousedown",this.enforceUnselectable,!1)}this.windowsHandled.push(b)},onWindowIgnore:function(a){var b=a.target;switch(this.environment.browser){case"firefox":case"safari":b.removeEventListener("mousedown",this.enforceUnselectable,!1)}for(var c=this.windowsHandled.length-1;c>=0;c--)this.windowsHandled[c]==b&&this.windowsHandled.splice(c,1)},onWindowGetList:function(a){for(var b=this.windowsHandled.length-1;b>=0;b--){var c=this.windowsHandled[b];!c.closed&&c.document||this.windowsHandled.splice(b,1)}for(var b=0;b<this.windowsHandled.length;b++)a.list.push(this.windowsHandled[b])},onServiceApplicable:function(a){var b=a.target,c=a.service.split(/\s*,\s*/);if(a.applicable=!1,b)for(var d=b;d&&d.getAttribute;d=d.parentNode){var e=d.getAttribute("NFLCIME");if(e){e=e.toLowerCase(),e=e.replace(/\s+/g,""),e=e.replace(/\bon\b/,"kb,cvt");for(var f=e.split(","),g=0;g<f.length;g++){var h=f[g];if("all"==h)return void(a.applicable=!0);for(var i=0;i<c.length;i++){var j=c[i];if(h==j)return void(a.applicable=!0)}}break}}},onModuleAdd:function(a){var b=a.module;if(this.checkModuleDependency(b)){var c=this.initializeModule(b);c?this.dispatchEvent({type:"ModuleRegister",module:b}):console.log("module not ready",a.module)}else this.loadDependentModules(b),this.pendingModules.push(b)},onModuleRegister:function(a){var b=a.module;this.registeredModules[b.id]=b,this.activateOnLoad[b.id]&&this.dispatchEvent({type:"ModuleActivate",module:b});for(var c=this.pendingModules.length-1;c>=0;c--){var d=this.pendingModules[c];if(this.checkModuleDependency(d)){this.pendingModules.splice(c,1),this.dispatchEvent({type:"ModuleAdd",module:d});break}}if(this.initialModuleList&&this.initialModuleList[this.initialModuleListIndex]==b.id&&(this.initialModuleListIndex++,this.initialModuleListIndex<this.initialModuleList.length)){var e=this.initialModuleList[this.initialModuleListIndex];this.dispatchEvent({type:"ModuleLoad",moduleId:e})}},onModuleLoad:function(a){var b=a.moduleId,c=a.activate,d=a.compressed,e=this.registeredModules[b];return e?c&&this.dispatchEvent({type:"ModuleActivate",module:e}):(c&&(this.activateOnLoad[b]=!0),d||this.loadScriptFile(b+".js")),!0},onModuleGetList:function(a){var b;for(b in this.registeredModules)a.list.unshift(this.registeredModules[b])},checkModuleDependency:function(a){if(a.dependency)for(var b=0;b<a.dependency.length;b++){var c=a.dependency[b];if(!this.registeredModules[c])return!1}if(a.inheritance)for(var b=0;b<a.inheritance.length;b++){var c=a.inheritance[b];if(!this.registeredModules[c])return!1}return!0},loadDependentModules:function(a){if(a.dependency)for(var b=0;b<a.dependency.length;b++){var c=a.dependency[b];this.registeredModules[c]||this.dispatchEvent({type:"ModuleLoad",moduleId:c,activate:!0})}if(a.inheritance)for(var b=0;b<a.inheritance.length;b++){var c=a.inheritance[b];this.registeredModules[c]||this.dispatchEvent({type:"ModuleLoad",moduleId:c})}},mapUrlToPackage:function(a){var b=a.split("."),c=["kb.js","ui.iframe.js","cvt.js","ui.lang.js","ui.kb.js","pers.cookie.js","rt.scrube.js","rt.js","cursor.js","lang.js","languages.json"];if(-1===c.indexOf(a)){if("cvt"==b[0]||"kb"==b[0]||"ui"==b[0]||"editor"==b[0])switch(b[0]){case"cvt":a="packages/cvt/"+a;break;case"kb":a="packages/kb/"+a;break;case"ui":a="packages/ui/"+b[1]+"/"+a;break;case"editor":a="packages/editor/"+a}}else a="src/"+a;return a},loadScriptFile:function(a){a=NFLCIME.mapUrlToPackage(a);var b=document.getElementsByTagName("HEAD")[0];if(b){for(var c=/^\w+:/.test(a)||/^\//.test(a)?a:this.environment.scriptURLRoot+a,d=document.getElementsByTagName("SCRIPT"),e=0;e<d.length;e++)if(d[e].src==c)return;var f=document.createElement("SCRIPT");f.src=c,b.appendChild(f)}},initializeModule:function(a){var b;if(a.inheritance){for(var c=a.initialize,d=0;d<a.inheritance.length;d++){var e,f=a.inheritance[d],g=this.registeredModules[f];for(e in g)void 0==a[e]&&(a[e]=g[e])}var h=[];this.getInitializationFunctions(a,h);for(var d=h.length-1;d>=0;d--){var i=h[d];b=i.call(a,this.environment,i!=c)}}else a.initialize&&(b=a.initialize(this.environment,!1));return 0!=b},getInitializationFunctions:function(a,b){var c=a.initialize;if(c){for(var d=!1,e=b.length-1;e>=0;e--)if(b[e]==c){d=!0;break}d||b.push(c)}if(a.inheritance)for(var e=a.inheritance.length-1;e>=0;e--){var f=a.inheritance[e],g=this.registeredModules[f];this.getInitializationFunctions(g,b)}},parseConfigurationCode:function(){var code=this.scriptNode.innerHTML,browser=this.environment.browser;if(code){code="this.environment.configuration = this.extend(this, {"+code.replace(/,\s*$/,"")+"});";try{eval(code)}catch(e){alert(e.message)}}this.extend(this.environment.configuration,this.init_modules)},enforceUnselectable:function(a){var b=a.target.getAttribute("unselectable");b&&"on"==b.toLowerCase()&&a.preventDefault()},initialize:function(){for(var a=document.getElementsByTagName("SCRIPT"),b=0;b<a.length;b++){var c=a[b],d=c.src;if(d){var e;if(e=/(.*\/)?[^\/]*[nflcime.js|nflcime-packed]$/i.exec(d)){this.scriptNode=c,this.scriptContainer=c.parentNode,this.environment.scriptURLRoot=e[1];var f=c.getAttribute("modules");f&&(f=f.replace(/^\s+/g,"$1").replace(/\s+$/))&&(this.initialModuleList=f.split(/\s*,\s*/));break}}}if(!this.scriptNode)return void alert("Cannot find the SCRIPT node linking to nflcime.js");var g=navigator.userAgent;-1!=g.indexOf("KHTML")?this.environment.browser="safari":-1!=g.indexOf("Gecko")&&(this.environment.browser="firefox"),this.parseConfigurationCode(),this.addEventListener("WindowListen",this),this.addEventListener("WindowIgnore",this),this.addEventListener("WindowGetList",this),this.addEventListener("ServiceApplicable",this),this.addEventListener("ModuleAdd",this),this.addEventListener("ModuleRegister",this),this.addEventListener("ModuleActivate",this),this.addEventListener("ModuleLoad",this),this.addEventListener("ModuleGetList",this);var h=this.environment.configuration.Modules;if(h)for(var b=0;b<h.length;b++){var i=h[b];"lang"==i.id&&i.compressed&&h.push({id:"cursor",activate:!0,compressed:!0}),this.dispatchEvent({type:"ModuleLoad",moduleId:i.id,activate:i.activate,compressed:i.compressed})}this.dispatchEvent({type:"WindowListen",target:window})},environment:{scriptUrlRoot:"",browser:"ie",configuration:{}},scriptNode:null,scriptContainer:null,settingsCode:"",eventListenerHash:{},closures:{},registeredModules:{},pendingModules:[],activateOnLoad:{},windowsHandled:[]}),NFLCIME.initialize(),NFLCIME.dispatchEvent({type:"ModuleAdd",module:{id:"pers.cookie",type:"persistence",onModuleActivate:function(a){var b=a.module;b==this&&(NFLCIME.addEventListener("PersistenceGetValue",this),NFLCIME.addEventListener("PersistenceSetValue",this))},onModuleDeactivate:function(a){var b=a.module;b==this&&(NFLCIME.removeEventListener("PersistenceGetValue",this),NFLCIME.removeEventListener("PersistenceSetValue",this))},onPersistenceGetValue:function(a){a.value=this.getValue(a.id,a.name)},onPersistenceSetValue:function(a){this.setValue(a.id,a.name,a.value)},getValue:function(a,b){var c=this.cookieValueGroups[a];c||(this.cookieValueGroups[a]=c=this.getCookieValues(a));var d=c[b];return d},setValue:function(a,b,c){var d=this.cookieValueGroups[a];d||(this.cookieValueGroups[a]=d=this.getCookieValues(a)),d[b]=c+"";var e,f=[];for(e in d){var g=d[e];"function"!=typeof g&&f.push(e+"::"+g)}var h=new Date,i=new Date(h.getTime()+31536e6);document.cookie=a+'="'+f.join("//")+'"; expires='+i},getCookieValues:function(a){var b,c=Array(),d=new RegExp("(^|\\s)"+a+'="([^"]*)"',"i");if(b=d.exec(document.cookie))for(var e=b[2].split("//"),f=0;f<e.length;f++){var g=e[f].split("::"),h=g[0],i=g[1];"PHPSESSID"!=h&&(c[h]=i)}return c},initialize:function(a,b){NFLCIME.addEventListener("ModuleActivate",this),NFLCIME.addEventListener("ModuleDeactivate",this)},cookieValueGroups:{}}}),NFLCIME.dispatchEvent({type:"ModuleAdd",module:{id:"ui.iframe.base",type:"iframe",onModuleActivate:function(a){var b=a.module;b==this&&(this.stopAnimation(),this.url!=this.urlLoaded?document.body?this.loadPage():this.attachDOMHandler(window,"load","loadPage"):this.show())},onModuleDeactivate:function(a){var b=a.module;b==this&&(this.iFrame?a.animation?this.startAnimation(a.animation):this.hide():document.body||this.detachDOMHandler(window,"load","loadPage"))},onMouseMove:function(a){var b=this.getEventPosition(a);"move"==this.dragAction?this.moveBy(b.x-this.dragActionMousePosition.x,b.y-this.dragActionMousePosition.y):"resize"==this.dragAction&&this.resizeBy(b.x-this.dragActionMousePosition.x,b.y-this.dragActionMousePosition.y,this.dragActionParameters)},onMouseDown:function(a){this.bringToTop()},onFocus:function(a){this.bringToTop()},onMouseUp:function(a){this.stopDragAction()},onLoseCapture:function(a){this.stopDragAction()},onLoad:function(a){this.iFrameWindow=this.getIFrameWindow(this.iFrame);var b=this;this.iFrameWindow.NFLCIME=NFLCIME,this.iFrameWindow.module=this,this.iFrameWindow.show=function(){b.show()},this.iFrameWindow.hide=function(){b.hide()},this.iFrameWindow.bringToTop=function(){b.bringToTop()},this.iFrameWindow.applyLayout=function(a){b.applyLayout(a)},this.iFrameWindow.startMoving=function(a){b.startMoving(a)},this.iFrameWindow.startResizing=function(a,c){b.startResizing(a,c)},this.adjustDimension(),this.show(),this.iFrameWindow.initialize&&this.iFrameWindow.initialize(this.environment),this.attachDOMHandler(this.iFrameWindow,"focus","onFocus"),this.attachDOMHandler(this.iFrameWindow,"mousedown","onMouseDown"),this.attachDOMHandler(this.iFrameWindow,"unload","onUnload"),NFLCIME.dispatchEvent({type:"WindowListen",target:this.iFrameWindow})},onUnload:function(a){this.iFrameWindow.shutdown&&this.iFrameWindow.shutdown(),NFLCIME.dispatchEvent({type:"WindowIgnore",target:this.iFrameWindow}),this.iFrameWindow=null},onUnloadRemoveIframes:function(a){for(var b=0;b<this.allIFrames.length;b++){var c=this.allIFrames[b],d=this.getIFrameWindow(c);d.shutdown&&d.shutdown()}for(var b=0;b<this.allIFrames.length;b++)document.body.removeChild(this.allIFrames[b]);this.allIFrames=[]},mergeOptions:function(a){var b,c={fixed:!0,x:0,y:0,hAlign:"left",vAlign:"top",width:"default",height:"default",minWidth:50,minHeight:50,collapsed:!1};for(b in c){var d={type:"PersistenceGetValue",id:this.id,name:b,value:void 0};if(NFLCIME.dispatchEvent(d),void 0!=d.value){var e=typeof c[b],f=d.value;switch(e){case"boolean":f="true"==f;break;case"number":f=parseFloat(f)}c[b]=f}else if(a){var g=a[b];void 0!=g&&(c[b]=g)}}return c},loadPage:function(){if(!this.iFrame){var a=this.mergeOptions(this.options);this.addToParent(a)}this.urlLoaded=this.url,this.iFrameWindow?this.iFrameWindow.location.replace(this.url):this.iFrame.src=this.url},addToParent:function(a){this.iFrame=document.createElement("IFRAME"),this.iFrame.id=this.id,this.iFrame.name=this.id,this.iFrame.style.visibility="hidden",this.iFrame.style.width="50px",this.iFrame.style.height="50px",this.iFrame.style.border="0px",this.iFrame.style.zIndex=this.zIndexStart+this.allIFrames.length,this.iFrame.allowTransparency=!0,this.iFrame.setAttribute("unselectable","on"),this.applyLayout(a),document.body.appendChild(this.iFrame),this.attachDOMHandler(this.iFrame,"load","onLoad"),this.allIFrames.push(this.iFrame)},show:function(){this.stopAnimation(),this.setOpacity(100)},hide:function(){this.setOpacity(0)},bringToTop:function(){for(var a=0;a<this.allIFrames.length;a++)if(this.allIFrames[a]==this.iFrame){this.allIFrames.splice(a,1),this.allIFrames.push(this.iFrame);break}for(var a=0,b=this.zIndexStart;a<this.allIFrames.length;a++,b++)this.allIFrames[a].style.zIndex=b},startMoving:function(a){this.startDragAction("move",null,a)},startResizing:function(a,b){this.collapsed||this.startDragAction("resize",a,b)},startDragAction:function(a,b,c){this.dragAction&&this.stopDragAction(),this.bringToTop(),this.dragAction=a,this.dragActionParameters=b,this.dragActionMousePosition=this.getEventPosition(c),this.attachDOMHandler(this.iFrameWindow.document,"mousemove","onMouseMove"),this.attachDOMHandler(this.iFrameWindow.document,"mouseup","onMouseUp"),this.attachDOMHandler(this.iFrameWindow.document.body,"losecapture","onLoseCapture"),this.setMouseCapture()},stopDragAction:function(){if(this.dragAction){this.detachDOMHandler(this.iFrameWindow.document,"mousemove","onMouseMove"),this.detachDOMHandler(this.iFrameWindow.document,"mouseup","onMouseUp"),this.detachDOMHandler(this.iFrameWindow.document.body,"losecapture","onLoseCapture"),this.releaseMouseCapture(),this.snapToViewPort();var a=this.id,b=this.getLayout(),c=[];if("move"!=this.dragAction&&"resize"!=this.dragAction||c.push("x","y","hAlign","vAlign"),"resize"==this.dragAction)for(var d=0;d<this.dragActionParameters.length;d++)switch(this.dragActionParameters[d]){case"left":case"right":c.push("width");break;case"top":case"bottom":c.push("height")}for(var d=0;d<c.length;d++){var e=c[d];NFLCIME.dispatchEvent({type:"PersistenceSetValue",id:a,name:e,value:b[e]})}this.dragAction="",this.dragActionMousePosition=null,this.dragActionParameters=null}},applyLayout:function(a){if(void 0!=a.width&&("default"==a.width?this.iFrame.adjustWidth=!0:(this.iFrame.adjustWidth=!1,this.iFrame.style.width=a.width+"px")),void 0!=a.height&&("default"==a.height?this.iFrame.adjustHeight=!0:(this.iFrame.adjustHeight=!1,this.iFrame.style.height=a.height+"px")),void 0!=a.minWidth&&(this.iFrame.minWidth=a.minWidth),void 0!=a.minHeight&&(this.iFrame.minHeight=a.minHeight),void 0!=a.collapsed&&(this.collapsed=a.collapsed),!this.iFrameWindow||"default"!=a.height&&"default"!=a.width&&void 0==a.minWidth&&void 0==a.minHeight||this.adjustDimension(),void 0!=a.fixed){if(void 0!=this.iFrame.fixed&&a.fixed!=this.iFrame.fixed){var b=(this.getElementPosition(this.iFrame),this.getScrollPosition(document)),c=!this.iFrame.fixed&&a.fixed?-1:1;this.moveBy(c*b.x,c*b.y)}this.iFrame.fixed=a.fixed}void 0!=a.hAlign&&(void 0!=this.iFrame.hAlign&&a.hAlign!=this.iFrame.hAlign&&(this.ieQuirkMode||("right"==a.hAlign?(this.iFrame.style.right=this.iFrame.style.left,this.iFrame.style.left="auto"):(this.iFrame.style.left=this.iFrame.style.right,this.iFrame.style.right="auto"))),this.iFrame.hAlign=a.hAlign),void 0!=a.vAlign&&(void 0!=this.iFrame.vAlign&&a.vAlign!=this.iFrame.vAlign&&(this.ieQuirkMode||("bottom"==a.vAlign?(this.iFrame.style.bottom=this.iFrame.style.top,this.iFrame.style.top="auto"):(this.iFrame.style.top=this.iFrame.style.bottom,this.iFrame.style.bottom="auto"))),this.iFrame.vAlign=a.vAlign),this.ieQuirkMode?(this.iFrame.style.position="absolute",this.iFrame.className=this.cssClassPrefix+"_"+this.iFrame.vAlign+this.iFrame.hAlign):this.iFrame.style.position=this.iFrame.fixed?"fixed":"absolute",void 0!=a.x&&(this.ieQuirkMode?this.iFrame.positionX=parseInt(a.x):"right"==this.iFrame.hAlign?(this.iFrame.style.right=a.x+"px",this.iFrame.style.left="auto"):(this.iFrame.style.left=a.x+"px",this.iFrame.style.right="auto")),void 0!=a.y&&(this.ieQuirkMode?this.iFrame.positionY=parseInt(a.y):"bottom"==this.iFrame.vAlign?(this.iFrame.style.bottom=a.y+"px",this.iFrame.style.top="auto"):(this.iFrame.style.top=a.y+"px",this.iFrame.style.bottom="auto"))},getLayout:function(){var a={};return a.fixed=this.iFrame.fixed,a.hAlign=this.iFrame.hAlign,a.vAlign=this.iFrame.vAlign,a.width=parseInt(this.iFrame.style.width),a.height=parseInt(this.iFrame.style.height),this.ieQuirkMode?(a.x=this.iFrame.positionX,a.y=this.iFrame.positionY):("right"==this.iFrame.hAlign?a.x=parseInt(this.iFrame.style.right):a.x=parseInt(this.iFrame.style.left),"bottom"==this.iFrame.vAlign?a.y=parseInt(this.iFrame.style.bottom):a.y=parseInt(this.iFrame.style.top)),a},getDocumentContentExtent:function(a){for(var b={width:0,height:0},c=a.body.firstChild;c;c=c.nextSibling)if(1==c.nodeType){var d=c.offsetLeft+c.offsetWidth,e=c.offsetTop+c.offsetHeight;b.width=Math.max(b.width,d),b.height=Math.max(b.height,e)}return b},adjustDimension:function(){var a=this.iFrameWindow.document,b=this.getDocumentContentExtent(a);if(this.iFrame.adjustWidth){var c=b.width;c<this.iFrame.minWidth&&(c=this.iFrame.minWidth),this.iFrame.style.width=c+"px",b.width=c}if(this.iFrame.adjustHeight){var d=b.height;d<this.iFrame.minHeight&&(d=this.iFrame.minHeight),this.iFrame.style.height=d+"px",b.height=d}var e=this.iFrameWindow.document.getElementById("frame");if(e)if(this.collapsed){if("collapsed"!=e.className){this.heightBeforeCollapse||(this.heightBeforeCollapse=b.height),this.frameHeightBeforeCollapse=e.getAttribute("height"),e.setAttribute("height",""),e.className="collapsed";var d=e.offsetHeight;this.iFrame.style.height=d+"px"}}else if("collapsed"==e.className){var d=this.heightBeforeCollapse;this.iFrame.style.height=d+"px",e.setAttribute("height",this.frameHeightBeforeCollapse),e.className="",this.heightBeforeCollapse=0}},attachDOMHandler:function(a,b,c){var d=this[c],e=this.closures[c];if(!e){var f=this;switch(this.browser){case"ie":e=function(a){a.target||(a.target=a.srcElement),a.returnValue=d.call(f,a)};break;case"firefox":case"safari":e=function(a){var b=d.call(f,a);void 0!=b&&0==b&&a.preventDefault()}}this.closures[c]=e}switch(this.browser){case"ie":a.attachEvent("on"+b,e);break;case"firefox":case"safari":a.addEventListener(b,e,!1)}},detachDOMHandler:function(a,b,c){var d=this.closures[c];if(d)switch(this.browser){case"ie":a.detachEvent("on"+b,d);break;case"firefox":case"safari":a.removeEventListener(b,d,!1)}},resizeBy:function(a,b,c){for(var d=0,e=0,f=0;f<c.length;f++)switch(c[f]){case"left":var g=parseInt(this.iFrame.style.width),h=g-a;h<this.iFrame.minWidth&&(h=this.iFrame.minWidth,a=g-h),this.iFrame.style.width=h+"px","left"==this.iFrame.hAlign&&(d=a);break;case"right":var g=parseInt(this.iFrame.style.width),h=g+a;h<this.iFrame.minWidth&&(h=this.iFrame.minWidth,a=h-g),this.iFrame.style.width=h+"px","right"==this.iFrame.hAlign&&(d=a),this.dragActionMousePosition.x+=a;break;case"top":var i=parseInt(this.iFrame.style.height),j=i-b;j<this.iFrame.minHeight&&(j=this.iFrame.minHeight,b=i-j),this.iFrame.style.height=j+"px","top"==this.iFrame.vAlign&&(e=b);break;case"bottom":var i=parseInt(this.iFrame.style.height),j=i+b;j<this.iFrame.minHeight&&(j=this.iFrame.minHeight,b=j-i),this.iFrame.style.height=j+"px","bottom"==this.iFrame.vAlign&&(e=b),this.dragActionMousePosition.y+=b}(d||e)&&this.moveBy(d,e)},moveBy:function(a,b){this.ieQuirkMode?("right"==this.iFrame.hAlign?this.iFrame.positionX-=a:this.iFrame.positionX+=a,"bottom"==this.iFrame.vAlign?this.iFrame.positionY-=b:this.iFrame.positionY+=b):("right"==this.iFrame.hAlign?this.iFrame.style.right=parseInt(this.iFrame.style.right)-a+"px":this.iFrame.style.left=parseInt(this.iFrame.style.left)+a+"px","bottom"==this.iFrame.vAlign?this.iFrame.style.bottom=parseInt(this.iFrame.style.bottom)-b+"px":this.iFrame.style.top=parseInt(this.iFrame.style.top)+b+"px")},toggleCollapse:function(){this.collapsed=!this.collapsed,this.adjustDimension(),NFLCIME.dispatchEvent({type:"PersistenceSetValue",id:this.id,name:"collapsed",value:this.collapsed.toString()})},getEventPosition:function(a){var b={x:0,y:0};switch(this.browser){case"ie":b.x=a.clientX,b.y=a.clientY;var c=9==a.srcElement.nodeType?a.srcElement:a.srcElement.ownerDocument,d=this.getScrollPosition(c);b.x+=d.x,b.y+=d.y;break;case"firefox":case"safari":b.x=a.pageX,b.y=a.pageY}return b},getScrollPosition:function(a){var b={x:0,y:0};return a.compatMode&&"BackCompat"!=a.compatMode?(b.x=a.documentElement.scrollLeft,b.y=a.documentElement.scrollTop):(b.x=a.body.scrollLeft,b.y=a.body.scrollTop),b},getElementPosition:function(a){var b={x:0,y:0};b.x=a.offsetLeft,b.y=a.offsetTop;var c=a.offsetParent;if(c||"BODY"==a.tagName||(c=a.ownerDocument.body),c){var d=this.getElementPosition(c);b.x+=d.x,b.y+=d.y;var e=a.currentStyle;e||(e=getComputedStyle(a,"")),"fixed"==e.position&&(b.x+=c.scrollLeft,b.y+=c.scrollTop)}return b},getIFrameWindow:function(a){try{var b=this.getElementWindow(a);if(a.contentWindow)return a.contentWindow;if(a.contentDocument)return a.contentDocument.defaultView;b.frames&&b.frames[a.id]}catch(c){}},getWindowIFrame:function(a){for(var b=this.getIFramesRecursive(window),c=0;c<b.length;c++){var d=b[c],e=this.getIFrameWindow(d);if(e==a)return d}return null},getElementWindow:function(a){var b=a.ownerDocument;return b.defaultView?b.defaultView:b.parentWindow?b.parentWindow:void 0},getViewPort:function(a){var b={width:0,height:0};return a.compatMode&&"BackCompat"!=a.compatMode?(b.x=a.documentElement.clientWidth,b.y=a.documentElement.clientHeight):(b.x=a.body.clientWidth,b.y=a.body.clientHeight),{left:0,top:0,right:b.x,bottom:b.y}},getIFrameBounds:function(a){var b=this.getElementPosition(a);return{left:b.x,top:b.y,right:b.x+a.offsetWidth,bottom:b.y+a.offsetHeight}},snapToViewPort:function(){var a=this.getViewPort(document),b=this.getIFrameBounds(this.iFrame),c=!1,d={},e=this.snappingDistance;b.left-a.left<e?(d.x=0,d.hAlign="left",c=!0):a.right-b.right<e&&(d.x=0,d.hAlign="right",c=!0),this.iFrame.fixed&&(b.top-a.top<e?(d.y=0,d.vAlign="top",c=!0):a.bottom-b.bottom<e&&(d.y=0,d.vAlign="bottom",c=!0)),c&&this.applyLayout(d)},addIEQuirkModeCSSClass:function(){this.cssClassPrefix=this.id.replace(/\./g,"");var a="				.#prefix#_topleft {					left: expression( (this.positionX + ((this.fixed) ? document.body.scrollLeft : 0)) + 'px' );					top:  expression( (this.positionY + ((this.fixed) ? document.body.scrollTop : 0)) + 'px' );				}				.#prefix#_topright {					left: expression( (document.body.clientWidth - this.positionX - this.offsetWidth + ((this.fixed) ? document.body.scrollLeft : 0)) + 'px' );					top:  expression( (this.positionY + ((this.fixed) ? document.body.scrollTop : 0)) + 'px' );				}				.#prefix#_bottomleft {					left: expression( (this.positionX + ((this.fixed) ? document.body.scrollLeft : 0)) + 'px' );					top: expression( (document.body.clientHeight - this.positionY - this.offsetHeight + ((this.fixed) ? document.body.scrollTop : 0)) + 'px' );				}				.#prefix#_bottomright {					left: expression( (document.body.clientWidth - this.positionX - this.offsetWidth + ((this.fixed) ? document.body.scrollLeft : 0)) + 'px' );					top: expression( (document.body.clientHeight - this.positionY - this.offsetHeight + ((this.fixed) ? document.body.scrollTop : 0)) + 'px' );				}			";a=a.replace(/#prefix#/g,this.cssClassPrefix),"CSS1Compat"==document.compatMode&&(a=a.relace(/document\.body/g,"document.documentElement"));var b=document.getElementsByTagName("head")[0];if(b){var c=document.createElement("style");c.setAttribute("type","text/css"),c.styleSheet.cssText=a,b.appendChild(c)}},getIFrameWindowsRecursive:function(a){for(var b=[],c=a.document.getElementsByTagName("IFRAME"),d=0;d<c.length;d++){var e=this.getIFrameWindow(c[d]);b.push(e);var f=this.getIFrameWindowsRecursive(e);b.push.apply(b,f)}return b},getIFramesRecursive:function(a){for(var b=[],c=a.document.getElementsByTagName("IFRAME"),d=0;d<c.length;d++){var e=c[d],f=this.getIFrameWindow(e);b.push(e);var g=this.getIFramesRecursive(f);b.push.apply(b,g)}return b},setMouseCapture:function(){switch(this.browser){case"ie":this.iFrameWindow.document.body.setCapture();break;case"firefox":case"safari":for(var a=this.getIFrameWindowsRecursive(window),b=0;b<a.length;b++){var c=a[b];if(c!=this.iFrameWindow)try{this.attachDOMHandler(c,"mousemove","onMouseMoveRedirectFromIFrame",!0),this.attachDOMHandler(c,"mouseup","onMouseMoveRedirectFromIFrame",!0)}catch(d){}}this.attachDOMHandler(window,"mousemove","onMouseMoveRedirectFromParent"),this.attachDOMHandler(window,"mouseup","onMouseMoveRedirectFromParent"),this.attachDOMHandler(window,"blur","onBlurDuringCapture")}},releaseMouseCapture:function(){switch(this.browser){case"ie":this.iFrameWindow.document.body.releaseCapture();break;case"firefox":case"safari":for(var a=this.getIFrameWindowsRecursive(window),b=0;b<a.length;b++){var c=a[b];c!=this.iFrameWindow&&(this.detachDOMHandler(c,"mousemove","onMouseMoveRedirectFromIFrame",!0),this.detachDOMHandler(c,"mouseup","onMouseMoveRedirectFromIFrame",!0))}this.detachDOMHandler(window,"mousemove","onMouseMoveRedirectFromParent"),this.detachDOMHandler(window,"mouseup","onMouseMoveRedirectFromParent"),this.detachDOMHandler(window,"blur","onBlurDuringCapture")}},onMouseMoveRedirectFromIFrame:function(a){var b=9==a.target.nodeType?a.target:a.target.ownerDocument,c=b.defaultView,d=this.getWindowIFrame(c),e=(this.getScrollPosition(b),c.parent.document),f=this.getScrollPosition(e);if(d){var g=this.getElementPosition(d),h=b.createEvent("MouseEvent");h.initMouseEvent?h.initMouseEvent(a.type,!0,!0,a.view,a.detail,a.screenX,a.screenY,a.clientX+g.x-f.x,a.clientY+g.y-f.y,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget):(h.initEvent(a.type,!0,!0),h.view=a.view,h.detail=a.detail,h.screenX=a.screenX,h.screenY=a.screenY,h.clientX=a.clientX+g.x-f.x,h.clientY=a.clientY+g.y-f.y,h.pageX=a.pageX+g.x,h.pageY=a.pageY+g.y,h.ctrlKey=a.ctrlKey,h.altKey=a.altKey,h.shiftKey=a.shiftKey,h.metaKey=a.metaKey,h.button=a.button,h.relatedTarget=a.relatedTarget),e.body.dispatchEvent(h),a.stopPropagation(),a.preventDefault()}},onMouseMoveRedirectFromParent:function(a){var b=9==a.target.nodeType?a.target:a.target.ownerDocument,c=this.getElementPosition(this.iFrame),d=this.getScrollPosition(b),e=b.createEvent("MouseEvent");e.initMouseEvent?e.initMouseEvent(a.type,!0,!0,a.view,a.detail,a.screenX,a.screenY,a.clientX-d.x-c.x,a.clientY-d.y-c.y,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget):(e.initEvent(a.type,!0,!0),e.view=a.view,e.detail=a.detail,e.screenX=a.screenX,e.screenY=a.screenY,e.clientX=a.clientX-c.x,e.clientY=a.clientY-c.y,e.pageX=a.pageX-c.x,e.pageY=a.pageY-c.y,e.ctrlKey=a.ctrlKey,e.altKey=a.altKey,e.shiftKey=a.shiftKey,e.metaKey=a.metaKey,e.button=a.button,e.relatedTarget=a.relatedTarget),this.iFrameWindow.document.body.dispatchEvent(e),a.stopPropagation(),a.preventDefault()},onBlurDuringCapture:function(a){var b=document.createEvent("Event");b.initEvent("losecapture",!1,!1),this.iFrameWindow.document.body.dispatchEvent(b)},startAnimation:function(a){if(this.animationType=a,!this.animationIntervalId){var b=this.closures.doAnimation;if(!b){var c=this;b=function(){c.doAnimation()},this.closures.doAnimation=b}this.animationIntervalId=setInterval(b,20)}},stopAnimation:function(){this.animationType&&(this.animationType=null,this.animationIntervalId&&(clearInterval(this.animationIntervalId),this.animationIntervalId=0))},doAnimation:function(){switch(this.animationType){case"fade-out":this.setOpacity(this.opacity-20),this.opacity<=0&&this.stopAnimation();break;case"fade-in":this.setOpacity(this.opacity+20),this.opacity>=1&&this.stopAnimation()}},setOpacity:function(a){if(this.iFrameWindow&&this.iFrameWindow.setOpacity?this.opacity=this.iFrameWindow.setOpacity(a):this.opacity=a,this.opacity>0&&this.opacity<100)switch(this.iFrame.style.visibility="visible",this.browser){case"ie":this.iFrame.style.filter="alpha(opacity = "+this.opacity+")";break;case"firefox":case"safari":this.iFrame.style.opacity=this.opacity/100+""}else switch(this.iFrame.style.visibility=this.opacity>0?"visible":"hidden",this.browser){case"ie":this.iFrame.style.filter="",this.iFrame.style.removeAttribute("filter");break;case"firefox":case"safari":this.iFrame.style.opacity=""}},initialize:function(a,b){this.closures={},b||(this.browser=a.browser,"ie"==this.browser&&(document.documentMode&&document.documentMode>=7||"CSS1Compat"==document.compatMode&&-1!=agent.indexOf("MSIE 7")||(this.addIEQuirkModeCSSClass(),this.ieQuirkMode=!0)),this.attachDOMHandler(window,"beforeunload","onUnloadRemoveIframes")),b&&(NFLCIME.addEventListener("ModuleActivate",this),NFLCIME.addEventListener("ModuleDeactivate",this))},browser:"ie",ieQuirkMode:!1,cssClassPrefix:"",closures:null,iFrame:null,iFrameWindow:null,dragAction:"",dragActionParameters:null,dragActionMousePosition:null,allIFrames:[],zIndexStart:1e4,snappingDistance:40,animationType:"",animationIntervalId:0,opacity:100,collapsed:!1,heightBeforeCollapse:0,frameHeightBeforeCollapse:""}}),NFLCIME.dispatchEvent({type:"ModuleAdd",module:{id:"ui.iframe",type:"ui module loader",onModuleActivate:function(a){var b=a.module;if(b==this&&!this.active&&(this.active=!0,NFLCIME.addEventListener("UIModuleLoad",this,!0),NFLCIME.addEventListener("UIModuleGetStyleSheet",this),this.initialUIModules)){for(var c=0;c<this.initialUIModules.length;c++){var d=this.initialUIModules[c];NFLCIME.dispatchEvent({type:"UIModuleLoad",moduleId:d.id,url:d.url,options:d.options})}this.initialUIModules=null}},onModuleDeactivate:function(a){var b=a.module;b==this&&this.active&&(NFLCIME.removeEventListener("UIModuleLoad",this,!0),NFLCIME.removeEventListener("UIModuleGetStyleSheet",this),this.active=!1)},onUIModuleLoad:function(a){a.url&&(a.url=NFLCIME.mapUrlToPackage(a.url));var b=a.moduleId,c=a.url?a.url:a.moduleId+".html",d=a.options,e=this.UIModules[b];if("/"!=c.charAt(0)&&(c=this.URLRoot+c),e)e.url=c,e.options=d;else{var e={id:b,inheritance:["ui.iframe.base"],url:c,options:d};this.UIModules[b]=e,NFLCIME.dispatchEvent({type:"ModuleAdd",module:e})}NFLCIME.dispatchEvent({type:"ModuleActivate",module:e})},onUIModuleGetStyleSheet:function(a){switch(a.styleSheetType){case"frame":a.url=this.interfaceCSS}},initialize:function(a,b){this.URLRoot=a.scriptURLRoot,this.interfaceCSS=a.configuration.UIModuleFrameCSS?a.configuration.UIModuleFrameCSS:"ui.iframe.css",this.initialUIModules=a.configuration.UIModules,NFLCIME.addEventListener("ModuleActivate",this),NFLCIME.addEventListener("ModuleDeactivate",this)},active:!1,URLRoot:!1,interfaceCSS:null,initialUIModules:null,UIModules:{}}}),NFLCIME.dispatchEvent({type:"ModuleAdd",module:{id:"cursor",type:"core",onModuleActivate:function(a){var b=a.module;if(b==this&&!this.active){this.active=!0;var c=[];NFLCIME.dispatchEvent({type:"WindowGetList",list:c});for(var d=0;d<c.length;d++){var e=c[d];this.attachDOMHandlers(e)}NFLCIME.addEventListener("WindowListen",this),NFLCIME.addEventListener("WindowIgnore",this),NFLCIME.addEventListener("CursorMove",this),NFLCIME.addEventListener("CursorGetContext",this),NFLCIME.addEventListener("CursorGetFocusedEdit",this),NFLCIME.addEventListener("CursorSaveFocusedEdit",this),NFLCIME.addEventListener("CursorRestoreFocusedEdit",this),NFLCIME.addEventListener("CursorGetContainer",this),NFLCIME.addEventListener("CursorGetSelectedText",this),NFLCIME.addEventListener("CursorInsertText",this),NFLCIME.addEventListener("CursorInsertHTML",this),NFLCIME.addEventListener("CursorClearSelection",this),NFLCIME.addEventListener("CursorInsertEmptyText",this)}},onModuleDeactivate:function(a){var b=a.module;if(b==this&&this.active){this.active=!1;var c=[];NFLCIME.dispatchEvent({type:"WindowGetList",list:c});for(var d=0;d<c.length;d++){var e=c[d];this.detachDOMHandlers(e)}NFLCIME.removeEventListener("WindowListen",this),NFLCIME.removeEventListener("WindowIgnore",this),NFLCIME.removeEventListener("CursorMove",this),NFLCIME.removeEventListener("CursorGetContext",this),NFLCIME.removeEventListener("CursorGetFocusedEdit",this),NFLCIME.removeEventListener("CursorSaveFocusedEdit",this),NFLCIME.removeEventListener("CursorRestoreFocusedEdit",this),NFLCIME.removeEventListener("CursorGetContainer",this),NFLCIME.removeEventListener("CursorGetSelectedText",this),
NFLCIME.removeEventListener("CursorInsertText",this),NFLCIME.removeEventListener("CursorInsertHTML",this),NFLCIME.removeEventListener("CursorClearSelection",this)}},onCursorMove:function(a){var b=a.target,c=a.end,d=a.start,e=b.ownerDocument;switch(this.browser){case"ie":var f=e.selection.createRange();c>0?(0!=c&&f.moveEnd("character",c),0!=d&&f.moveStart("character",d)):(0!=d&&f.moveStart("character",d),0!=c&&f.moveEnd("character",c)),f.select();break;case"firefox":case"safari":if("TEXTAREA"==b.tagName||"INPUT"==b.tagName)c>0?(b.selectionEnd+=c,b.selectionStart+=d):(b.selectionStart+=d,b.selectionEnd+=c);else{var g=e.defaultView;try{var h=g.getSelection(),f=h.getRangeAt(0);if(c>0?(this.moveRangeEnd(b,f,c),this.moveRangeStart(b,f,d)):(this.moveRangeStart(b,f,d),this.moveRangeEnd(b,f,c)),"safari"==this.browser){var i=f.cloneRange();h.removeAllRanges(),h.addRange(i)}}catch(j){window.console&&console.log(j)}}}b==this.focusedEdit&&(this.previousCursorPosition=this.getCursorPosition(b))},onCursorSaveFocusedEdit:function(a){var b=a.target;this.previousFocusedEdit=b},onCursorRestoreFocusedEdit:function(a){if(this.previousFocusedEdit){var b=this.previousFocusedEdit,c=b.ownerDocument,d=c.parentWindow?c.parentWindow:c.defaultView;d.focus(),b.focus(),a.target=this.previousFocusedEdit}},onCursorGetContainer:function(a){var b=a.target;switch(this.browser){case"ie":if("TEXTAREA"==b.tagName||"INPUT"==b.tagName)a.container=b;else{var c=document.selection.createRange();a.container=c.parentElement()}break;case"firefox":case"safari":if("TEXTAREA"==b.tagName||"INPUT"==b.tagName)a.container=b;else{var d=b.ownerDocument,e=d.defaultView;try{var f=e.getSelection();if(f.rangeCount>0){var c=f.getRangeAt(0),g=c.commonAncestorContainer;a.container=1==g.nodeType?g:g.parentNode}}catch(h){window.console&&console.log(h)}}}},onCursorGetContext:function(a){var b=a.target,c=a.behindCount,d=a.aheadCount;switch(a.textBehind="",a.textAhead="",this.browser){case"ie":var e=document.selection.createRange();b.parentNode;e=e.duplicate();var f=e.getBookmark();e.collapse(!0);for(var g=0,h=!1;!h&&c>g;g++){e.moveStart("character",-1),h=!0;for(var i=e.parentElement();i;i=i.parentNode)if(i==b){a.textBehind=e.text,h=!1;break}}e.moveToBookmark(f),e.collapse(!1);for(var g=0,h=!1;!h&&d>g;g++){e.moveEnd("character",1),h=!0;for(var i=e.parentElement();i;i=i.parentNode)if(i==b){a.textAhead=e.text,h=!1;break}}e.moveToBookmark(f);break;case"firefox":case"safari":if("TEXTAREA"==b.tagName||"INPUT"==b.tagName){var j=b.value,k=b.selectionStart,l=Math.max(0,b.selectionStart-c),m=b.selectionEnd,n=Math.min(j.length,b.selectionEnd+d);a.textAhead=j.substring(m,n),a.textBehind=j.substring(l,k)}else{var o=b.ownerDocument,p=o.defaultView;try{var q=p.getSelection(),e=q.getRangeAt(0),r=e.toString(),s=e.cloneRange();s.collapse(!0),this.moveRangeStart(b,s,-c),a.textBehind=s.toString();var t=e.cloneRange();t.collapse(!0),this.moveRangeStart(b,t,r.length),this.moveRangeEnd(b,t,+d),a.textAhead=t.toString()}catch(u){window.console&&console.log(u)}}}},onCursorGetFocusedEdit:function(a){this.focusedEdit&&!this.windowLostFocus&&(a.target=this.focusedEdit)},onCursorInsertText:function(a){var b=a.target,c=a.text,d=b.ownerDocument;switch(this.browser){case"ie":var e=d.selection.createRange();e.text.length>0&&d.selection.clear(),c&&(e.text=c,e.collapse(!1),e.scrollIntoView());break;case"firefox":case"safari":if("TEXTAREA"==b.tagName||"INPUT"==b.tagName)if("firefox"==this.browser){if(c){c=c.replace(/([^\u000a]|^)\u000d/,"$1\n");for(var f=0;f<c.length;f++){var g=c.charCodeAt(f),a=d.createEvent("KeyEvents");a.initKeyEvent("keypress",!0,!0,k,!1,!1,!1,!1,0,g),b.dispatchEvent(a)}}else if(b.selectionStart!=b.selectionEnd){var a=d.createEvent("KeyEvents");a.initKeyEvent("keypress",!0,!0,k,!1,!1,!1,!1,8,0),b.dispatchEvent(a)}}else{var h=b.value,i=h.substr(0,b.selectionStart)+c,j=h.substr(b.selectionEnd);b.value=i,b.scrollTop=b.scrollHeight,b.scrollLeft=b.scrollWidth,b.value=i+j,b.setSelectionRange(i.length,i.length)}else{var k=d.defaultView,l=k.getSelection(),e=l.getRangeAt(0);if(e.toString().length>0&&e.deleteContents(),c){var m=d.createTextNode(c);e.insertNode(m);var n=this.findNormalizedPosition(m,c.length),o=m.parentNode;o.normalize();var p=o.childNodes[n.nodeIndex];e.selectNode(p),e.setStart(p,n.textIndex),e.setEnd(p,n.textIndex),l.removeAllRanges(),l.addRange(e)}var q=d.createElement("SPAN");q.textContent="‍",e.insertNode(q);var r=q.offsetTop,s=r+q.offsetHeight,t=q.offsetLeft,u=t+q.offsetWidth;for(view=q.offsetParent;view&&1==view.nodeType;view=view.parentNode){var v=view.scrollTop,w=v+view.clientHeight,x=view.scrollLeft,y=x+view.clientWidth;if(view==d.body){var z=view.parentNode;w=v+z.clientHeight,y=x+z.clientWidth}v>r?view.scrollTop+=r-v:s>w&&(view.scrollTop+=s-w),x>t?view.scrollLeft+=t-x:u>y&&(view.scrollLeft+=u-y);var A=view.offsetLeft-view.scrollLeft,B=view.offsetTop-view.scrollTop;r+=A,t+=B}var C=q.parentNode,D=q.previousSibling,E=q.nextSibling;if(D&&E&&3==D.nodeType&&3==E.nodeType){var n=this.findNormalizedPosition(D,D.nodeValue.length);C.normalize();var p=C.childNodes[n.nodeIndex];e.selectNode(p),e.setStart(p,n.textIndex),e.setEnd(p,n.textIndex),l.removeAllRanges(),l.addRange(e)}C.removeChild(q)}}b==this.focusedEdit&&(this.previousCursorPosition=this.getCursorPosition(b))},onCursorInsertHTML:function(a){var b=a.target,c=a.html,d=(a.text,b.ownerDocument);if("TEXTAREA"==b.tagName||"INPUT"==b.tagName)this.onCursorInsertText(a);else switch(this.browser){case"ie":var e=d.selection.createRange();e.text.length>0&&d.selection.clear(),e.pasteHTML(c),e.collapse(!1),e.scrollIntoView();break;case"firefox":case"safari":var f=d.defaultView,g=f.getSelection(),e=g.getRangeAt(0),h=e.createContextualFragment(c),i=h.lastChild,j=e.startContainer.parentNode;if(e.deleteContents(),j.getAttribute("lang")){var k=document.createRange();k.setStartAfter(j),k.insertNode(h)}else e.insertNode(h);if(i){g.collapse(i,3==i.nodeType?i.nodeValue.length:1);var l=3==i.nodeType?i.parentNode:i;l.scrollIntoView(!1)}}b==this.focusedEdit&&(this.previousCursorPosition=this.getCursorPosition(b))},onCursorInsertTag:function(a){var b=a.target,c=a.html,d=b.ownerDocument;if("TEXTAREA"==b.tagName||"INPUT"==b.tagName);else switch(this.browser){case"ie":var e=d.selection.createRange();e.text.length>0&&d.selection.clear(),e.pasteHTML(c),e.collapse(!0),e.scrollIntoView();break;case"firefox":case"safari":var f=d.defaultView,g=f.getSelection(),e=g.getRangeAt(0);e.deleteContents();var h=e.createContextualFragment(c),i=h.lastChild;if(e.insertNode(h),i){e.setStart(i,0),e.setEnd(i,0),g.removeAllRanges(),g.addRange(e);var j=3==i.nodeType?i.parentNode:i;j.scrollIntoView(!1)}}b==this.focusedEdit},onCursorInsertEmptyText:function(a){var b=a.target,c=b.getSelection(),d=c.getRangeAt(0),e=d.commonAncestorContainer.parentNode,f=function(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a},g=b.createTextNode("\ufeff"),g=f(g,e);d.setStartAfter(g),c.removeAllRanges(),c.addRange(d)},onCursorGetSelectedText:function(a){var b=a.target,c=(a.text,b.ownerDocument);switch(this.browser){case"ie":var d=c.selection.createRange();a.text=d.text;break;case"firefox":case"safari":if("TEXTAREA"==b.tagName||"INPUT"==b.tagName)a.text=b.value.substring(b.selectionStart,b.selectionEnd);else{var e=c.defaultView;if(e){var f=e.getSelection();if(f.rangeCount>0){var d=f.getRangeAt(0);a.text=d.toString()}else a.text=""}}}},onCursorClearSelection:function(a){var b=a.target,c=b.ownerDocument;switch(this.browser){case"ie":var d=c.selection.createRange();d.parentElement();d.text.length>0&&c.selection.clear(),d.collapse(!1);break;case"firefox":case"safari":if("TEXTAREA"==b.tagName||"INPUT"==b.tagName){var e=b.selectionStart,f=b.selectionEnd;b.value=b.value.substr(0,e)+b.value.substr(f),b.selectionEnd=e}else{var g=c.defaultView,h=g.getSelection(),d=h.getRangeAt(0);d.deleteContents()}}},fireElementChangeEvent:function(){var a;if(a=this.focusedEdit?this.focusedEdit:this.previousFocusedEdit){var b,c=a.ownerDocument;c.createEventObject?(b=c.createEventObject(),a.fireEvent("onchange",b)):(b=c.createEvent("HTMLEvents"),b.initEvent("change",!0,!0),a.dispatchEvent(b))}},onElementFocus:function(a){var b=a.target;if(b&&9==b.nodeType&&(b=b.body),b&&"HTML"==b.tagName&&(b=b.ownerDocument.body),!b||"IFRAME"!=b.tagName){if(this.focusedEdit!=b){var c=this.focusedEdit;this.isEditControl(b)||(b=null),this.focusedEdit=b,NFLCIME.dispatchEvent({type:"FocusChanged",target:this.focusedEdit,previousTarget:c}),this.focusedEdit?(this.previousCursorPosition=this.getCursorPosition(this.focusedEdit),this.scheduleCursorCheck(!0)):this.stopCursorCheck()}this.onElementBlurTimeoutId&&(clearTimeout(this.onElementBlurTimeoutId),this.onElementBlurTimeoutId=0)}},onElementBlurTimeoutId:0,onElementBlur:function(a){var b=a.target;if(b&&(b.hasAttribute&&b.hasAttribute("nflcime")&&this.fireElementChangeEvent(),9==b.nodeType&&(b=b.body),b&&"IFRAME"!=b.tagName&&this.focusedEdit&&!this.windowLostFocus)){NFLCIME.dispatchEvent({type:"CursorSaveFocusedEdit",target:this.focusedEdit}),this.onElementBlurTimeoutId&&clearTimeout(this.onElementBlurTimeoutId);var c=this.closures.onElementBlurNotify;if(!c){var d=this;c=function(){d.onElementBlurNotify()},this.closures.onElementBlurNotify=c}this.onElementBlurTimeoutId=setTimeout(c,50)}},onElementBlurNotify:function(){this.fireElementChangeEvent();var a=this.focusedEdit;this.focusedEdit=null,NFLCIME.dispatchEvent({type:"FocusChanged",target:this.focusedEdit,previousTarget:a}),this.onElementBlurTimeoutId=0,this.stopCursorCheck()},onWindowFocus:function(a){a.target.nodeType||(this.windowLostFocus&&this.focusedEdit&&(!this.focusedEdit.hasFocus||this.focusedEdit.hasFocus()?NFLCIME.dispatchEvent({type:"FocusChanged",target:this.focusedEdit,previousTarget:null}):this.focusedEdit=null),this.windowLostFocus=!1)},onWindowBlur:function(a){a.target.nodeType||(this.focusedEdit&&a.target.document==this.focusedEdit.ownerDocument&&NFLCIME.dispatchEvent({type:"FocusChanged",target:null,previousTarget:this.focusedEdit}),this.windowLostFocus=!0)},onWindowListen:function(a){var b=a.target;this.attachDOMHandlers(b)},onWindowIgnore:function(a){var b=a.target,c=b.doc;if(this.detachDOMHandlers(b),this.focusedEdit&&this.focusedEdit.ownerDocument==c){var d=this.focusedEdit;this.focusedEdit=null,NFLCIME.dispatchEvent({type:"FocusChanged",target:this.focusedEdit,previousTarget:d})}if(this.previousFocusedEdit&&this.previousFocusedEdit.ownerDocument==c&&(this.previousFocusedEdit=null),this.previousCursorPosition)switch(this.previousCursorPosition.type){case"ie range":var e=this.previousCursorPosition.data.parentElement();e&&e.ownerDocument!=c||(this.previousCursorPosition=null);break;case"dom selection indices":var e=this.previousCursorPosition.data.edit;e&&e.ownerDocument!=c||(this.previousCursorPosition=null);break;case"dom range":var e=this.previousCursorPosition.data.commonAncestorContainer;e&&e.ownerDocument!=c||(this.previousCursorPosition=null)}},onKeyDown:function(a){this.scheduleCursorCheck()},onMouseDown:function(a){var b=a.target,c=1==b.nodeType?b.ownerDocument:b;this.attachDOMHandler(c,"mousedown","onMouseMove"),this.scheduleCursorCheck(!1)},onMouseUp:function(){this.detachDOMHandler(doc,"mousedown","onMouseMove")},onMouseMove:function(){this.checkCursorPosition(!1)},attachDOMHandlers:function(a){var b=a.document;switch(this.attachDOMHandler(b,"keydown","onKeyDown"),this.attachDOMHandler(b,"mousedown","onMouseDown"),this.attachDOMHandler(b,"mouseup","onMouseDown"),this.browser){case"ie":this.attachDOMHandler(b,"focusin","onElementFocus"),this.attachDOMHandler(b,"focusout","onElementBlur");break;case"firefox":this.attachDOMHandler(b,"focus","onElementFocus",!0),this.attachDOMHandler(b,"blur","onElementBlur",!0),this.attachDOMHandler(a,"focus","onWindowFocus"),this.attachDOMHandler(a,"blur","onWindowBlur");break;case"safari":this.attachDOMHandler(b,"DOMFocusIn","onElementFocus"),this.attachDOMHandler(b,"DOMFocusOut","onElementBlur"),this.attachDOMHandler(a,"focus","onWindowFocus"),this.attachDOMHandler(a,"blur","onWindowBlur")}},detachDOMHandlers:function(a){var b=a.document;switch(this.attachDOMHandler(b,"keydown","onKeyDown"),this.attachDOMHandler(b,"mousedown","onMouseDown"),this.attachDOMHandler(b,"mouseup","onMouseDown"),this.attachDOMHandler(b,"mousemove","onMouseMove"),this.browser){case"ie":this.detachDOMHandler(b,"focusin","onElementFocus"),this.detachDOMHandler(b,"focusout","onElementBlur");break;case"firefox":this.detachDOMHandler(b,"focus","onElementFocus",!0),this.detachDOMHandler(b,"blur","onElementBlur",!0),this.detachDOMHandler(a,"focus","onWindowFocus"),this.detachDOMHandler(a,"blur","onWindowBlur");break;case"safari":this.detachDOMHandler(b,"DOMFocusIn","onElementFocus"),this.detachDOMHandler(b,"DOMFocusOut","onElementBlur"),this.detachDOMHandler(a,"focus","onWindowFocus"),this.detachDOMHandler(a,"blur","onWindowBlur")}},attachDOMHandler:function(a,b,c,d){var e=this[c],f=this.closures[c];if(!f){var g=this;switch(this.browser){case"ie":f=function(a){a.target||(a.target=a.srcElement),a.returnValue=e.call(g,a)};break;case"firefox":case"safari":f=function(a){var b=e.call(g,a);void 0!=b&&0==b&&a.preventDefault()}}this.closures[c]=f}switch(this.browser){case"ie":a.attachEvent("on"+b,f);break;case"firefox":case"safari":a.addEventListener(b,f,!!d)}},detachDOMHandler:function(a,b,c,d){var e=this.closures[c];if(e)switch(this.browser){case"ie":a.detachEvent("on"+b,e);break;case"firefox":case"safari":a.removeEventListener(b,e,!!d)}},isEditControl:function(a){return"TEXTAREA"==a.tagName?!a.disabled:"INPUT"!=a.tagName||"text"!=a.type&&"file"!=a.type&&"password"!=a.type?"true"==a.contentEditable?!a.disabled:a.ownerDocument&&"on"==a.ownerDocument.designMode?!a.disabled:!1:!a.disabled},moveRangeEnd:function(a,b,c){if(0!=c){var d=0>c?this.findIndexBehind(a,b.endContainer,b.endOffset,-c,!0):this.findIndexAhead(a,b.endContainer,b.endOffset,c,!0);b.setEnd(d.node,d.index)}},moveRangeStart:function(a,b,c){if(0!=c){var d=0>c?this.findIndexBehind(a,b.startContainer,b.startOffset,-c,!0):this.findIndexAhead(a,b.startContainer,b.startOffset,c,!0);b.setStart(d.node,d.index)}},findIndexAhead:function(a,b,c,d,e){var f={node:b,index:c,amount:0};if(3==b.nodeType){var g=b.nodeValue;f.index=Math.min(g.length,c+d),f.amount=f.index-c}else for(var h=0,i=b.childNodes[c];i&&(f=this.findIndexAhead(a,i,0,d-h,!1),h+=f.amount,f.amount=h,h!=d);i=i.nextSibling);if(f.amount<d&&b!=a&&e){var j=this.findNodeIndex(b),k=this.findIndexAhead(a,b.parentNode,j+1,d-f.amount,!0);k.amount+=f.amount,f=k}return f},findIndexBehind:function(a,b,c,d,e){var f={node:b,index:c,amount:0};if(3==b.nodeType)f.index=Math.max(0,c-d),f.amount=c-f.index;else if(c>0)for(var g=0,h=b.childNodes[c-1];h;h=h.previousSibling){var i;if(i=3==h.nodeType?h.nodeValue.length:h.childNodes.length,f=this.findIndexBehind(a,h,i,d-g,!1),g+=f.amount,f.amount=g,g==d)break}if(f.amount<d&&b!=a&&e){var j=this.findNodeIndex(b),k=this.findIndexBehind(a,b.parentNode,j,d-f.amount,!0);k.amount+=f.amount,f=k}return f},findNormalizedPosition:function(a,b){for(var c=b,d=a,e=a.previousSibling;e&&3==e.nodeType;e=e.previousSibling)c+=e.nodeValue.length,d=e;var f=this.findNodeIndex(d);return{nodeIndex:f,textIndex:c}},findNodeIndex:function(a){for(var b=0,c=a.parentNode.firstChild;c;b++,c=c.nextSibling)if(c==a)return b},scheduleCursorCheck:function(a){if(a){if(!this.cursorCheckIntervalID){var b=this.closures.checkCursorPositionInterval;if(!b){var c=this,b=function(){c.checkCursorPosition()};this.closures.checkCursorPositionInterval=b}this.cursorCheckIntervalID=setInterval(b,100)}}else if(!this.cursorCheckTimeoutID){var b=this.closures.checkCursorPositionTimeout;if(!b){var c=this,b=function(){c.checkCursorPosition(),c.cursorCheckTimeoutID=0};this.closures.checkCursorPositionTimeout=b}this.cursorCheckTimeoutID=setTimeout(b,0)}},stopCursorCheck:function(){this.cursorCheckTimeoutID&&(clearTimeout(this.cursorCheckTimeoutID),this.cursorCheckIntervalID=0),this.cursorCheckIntervalID&&(clearInterval(this.cursorCheckIntervalID),this.cursorCheckIntervalID=0)},checkCursorPosition:function(){if(this.focusedEdit&&!this.windowLostFocus){var a=this.getCursorPosition(this.focusedEdit),b=this.previousCursorPosition;this.compareCursorPosition(a,b)?this.disposeCursorPosition(a):(b&&(NFLCIME.dispatchEvent({type:"CursorMoved",target:this.focusedEdit}),this.disposeCursorPosition(b)),this.previousCursorPosition=a)}},getCursorPosition:function(a){try{var b={};switch(this.browser){case"ie":var c=a.ownerDocument,d=c.selection.createRange();d&&d.duplicate?(b.data=d.duplicate(),b.type="ie range"):b.type="null";break;case"firefox":case"safari":if("TEXTAREA"==a.tagName||"INPUT"==a.tagName)b.data={edit:a,selectionStart:a.selectionStart,selectionEnd:a.selectionEnd},b.type="dom selection indices";else{var c=a.ownerDocument,e=c.defaultView,f=e.getSelection();if(f.rangeCount>0){var d=f.getRangeAt(0);b.data=d.cloneRange(),b.type="dom range"}else b.type="null"}}return b}catch(g){return null}},compareCursorPosition:function(a,b){if(!a||!b)return!1;if(a.type!=b.type)return!1;switch(a.type){case"ie range":return a.data.isEqual(b.data);case"dom selection indices":return a.data.edit==b.data.edit&&a.data.selectionStart==b.data.selectionStart&&a.data.selectionEnd==b.data.selectionEnd;case"dom range":try{return 0==a.data.compareBoundaryPoints(Range.END_TO_END,b.data)&&0==a.data.compareBoundaryPoints(Range.START_TO_START,b.data)}catch(c){return!1}}},disposeCursorPosition:function(a){if(a)switch(a.type){case"dom range":a.data.detach()}},initialize:function(a){this.browser=a.browser,this.closures={},NFLCIME.addEventListener("ModuleActivate",this),NFLCIME.addEventListener("ModuleDeactivate",this)},active:!1,browser:null,closures:null,focusedEdit:null,previousFocusedEdit:null,windowLostFocus:!1,previousCursorPosition:null,cursorCheckIntervalID:0,cursorCheckTimeoutID:0}}),NFLCIME.dispatchEvent({type:"ModuleAdd",module:{id:"kb",type:"core",dependency:["cursor"],onModuleActivate:function(a){var b=a.module;if(b==this){if(!this.active){this.active=!0;var c=[];NFLCIME.dispatchEvent({type:"WindowGetList",list:c});for(var d=0;d<c.length;d++){var e=c[d];this.attachDOMHandlers(e)}NFLCIME.addEventListener("WindowListen",this),NFLCIME.addEventListener("WindowIgnore",this),NFLCIME.addEventListener("KeyboardGetStates",this),NFLCIME.addEventListener("KeyboardSetStates",this),NFLCIME.addEventListener("KeyboardGetPossibleKeys",this),NFLCIME.addEventListener("KeyboardGetDeadKeys",this),NFLCIME.addEventListener("CursorMoved",this),NFLCIME.dispatchEvent({type:"KeyboardStatesChanged"})}}else"keyboard layout"==b.type&&NFLCIME.dispatchEvent({type:"ModuleDeactivate",module:this})},onModuleDeactivate:function(a){var b=a.module;if(b==this&&this.active){this.active=!1;var c=[];NFLCIME.dispatchEvent({type:"WindowGetList",list:c});for(var d=0;d<c.length;d++){var e=c[d];this.detachDOMHandlers(e)}this.physicalKeyboardStates.altKey=!1,this.physicalKeyboardStates.ctrlKey=!1,this.physicalKeyboardStates.shiftKey=!1,this.clearVirtualKeys(!0),NFLCIME.removeEventListener("WindowListen",this),NFLCIME.removeEventListener("WindowIgnore",this),NFLCIME.removeEventListener("KeyboardGetStates",this),NFLCIME.removeEventListener("KeyboardSetStates",this),NFLCIME.removeEventListener("KeyboardGetPossibleKeys",this),NFLCIME.removeEventListener("KeyboardGetDeadKeys",this),NFLCIME.removeEventListener("CursorMoved",this)}},onWindowListen:function(a){var b=a.target;this.attachDOMHandlers(b)},onWindowIgnore:function(a){var b=a.target;this.detachDOMHandlers(b)},onKeyboardGetStates:function(a){a.states.altKey=this.combinedKeyboardStates.altKey,a.states.ctrlKey=this.combinedKeyboardStates.ctrlKey,a.states.shiftKey=this.combinedKeyboardStates.shiftKey,a.states.capsLock=this.combinedKeyboardStates.capsLock,a.states.plane=this.combinedKeyboardStates.plane},onKeyboardSetStates:function(a){void 0!==a.states.altKey&&(this.virtualKeyboardStates.altKey=!this.physicalKeyboardStates.altKey&&a.states.altKey),void 0!==a.states.ctrlKey&&(this.virtualKeyboardStates.ctrlKey=!this.physicalKeyboardStates.ctrlKey&&a.states.ctrlKey),void 0!==a.states.shiftKey&&(this.virtualKeyboardStates.shiftKey=!this.physicalKeyboardStates.shiftKey&&a.states.shiftKey),void 0!==a.states.capsLock&&(this.virtualKeyboardStates.capsLock=!this.physicalKeyboardStates.capsLock&&a.states.capsLock),this.dispatchKeyboardStateChangeEvent()},onKeyboardGetPossibleKeys:function(a){if(this.multikeyCombinations&&this.currentContext){var b,c=this.getKeyMappings();if(c){var d=this.currentContext;for(b in this.multikeyCombinations)if(0===b.indexOf(d)&&d.length<b.length){var e,f=b.substr(d.length);for(e in c){var g=c[e],h="object"==typeof g?g.context:g;if(f==h){var i=this.multikeyCombinations[b];a.keyCodes.push(parseInt(e)),a.characters.push("object"==typeof i?i.insert:i)}}}}}},onKeyboardGetDeadKeys:function(a){if(this.multikeyCombinations){var b=this.getKeyMappings();if(b){var c;for(c in b){var d=b[c];if("object"==typeof d&&!d.insert){var e,f=d.context;for(e in this.multikeyCombinations)0===e.indexOf(f)&&a.keyCodes.push(parseInt(c))}}}}},onCursorMoved:function(a){this.clearContext()},onKeyDown:function(a){var b=!0;switch(a.keyCode){case 18:case 17:case 16:this.physicalKeyboardStates.altKey=a.altKey,this.physicalKeyboardStates.ctrlKey=a.ctrlKey,this.physicalKeyboardStates.shiftKey=a.shiftKey,this.physicalKeyboardStates.altKey&&(this.virtualKeyboardStates.altKey=!1),this.physicalKeyboardStates.ctrlKey&&(this.virtualKeyboardStates.ctrlKey=!1),this.physicalKeyboardStates.shiftKey&&(this.virtualKeyboardStates.shiftKey=!1);break;case 20:this.capsLockPressed||(this.physicalKeyboardStates.capsLock=!this.physicalKeyboardStates.capsLock,this.capsLockPressed=!0,this.physicalKeyboardStates.capsLock&&(this.virtualKeyboardStates.capsLock=!1));break;default:b=!1}this.keyCode=0;var c=this.getFocusedEdit();if(c&&this.isServiceApplicable(c))if(b)this.dispatchKeyboardStateChangeEvent();else{this.keyCode=a.keyCode;var d=this.translateKey(a.keyCode);switch(NFLCIME.dispatchEvent({type:"KeyboardPressed",target:c,keyCode:d}),this.browser){case"ie":case"safari":if(8==a.keyCode)return this.onKeyPress(a)}}},onKeyUp:function(a){var b=!0;switch(a.keyCode){case 18:case 17:case 16:this.physicalKeyboardStates.altKey=a.altKey,this.physicalKeyboardStates.ctrlKey=a.ctrlKey,this.physicalKeyboardStates.shiftKey=a.shiftKey;break;case 20:this.capsLockPressed&&(this.capsLockPressed=!1);break;default:b=!1}var c=this.getFocusedEdit();if(c&&this.isServiceApplicable(c))if(b)this.dispatchKeyboardStateChangeEvent();else{var d=this.translateKey(a.keyCode);NFLCIME.dispatchEvent({type:"KeyboardReleased",target:c,keyCode:d}),this.clearVirtualKeys()}},onKeyPress:function(a){if(this.keyCode){var b=this.translateKey(this.keyCode);this.keyCode=0;var c=this.getFocusedEdit();if(c){var d="firefox"==this.browser?!a.charCode:a.fake,e=this.determineChanges(c,b);if((13==b||32==b)&&!d)return void(e&&this.rememberChanges(e));if(!(8!=b&&36!=b||d&&"firefox"!=this.browser)&&(a={type:"CursorGetSelectedText",target:c,text:""},NFLCIME.dispatchEvent(a),a.text.length>0))return;if(8==b&&d&&"firefox"!=this.browser&&(e||(a={type:"CursorGetContext",target:c,textAhead:"",textBehind:"",behindCount:1,aheadCount:0},NFLCIME.dispatchEvent(a),a.textBehind.length>0&&(e={cursorStart:-1,cursorEnd:0,insert:"",context:""}))),e){if(e.cursorStart||e.cursorEnd)NFLCIME.dispatchEvent({type:"CursorMove",target:c,start:e.cursorStart,end:e.cursorEnd});else if(" "==e.insert&&!d)return;var f={type:"LanguageGet"};NFLCIME.dispatchEvent(f);var g=c.ownerDocument,h=g.defaultView,i=h.getSelection();if("None"==i.type)return!1;var j=i.getRangeAt(0),k=null,l=null;k="P"==j.startContainer.nodeName&&j.startContainer.lang?j.startContainer:j.commonAncestorContainer.parentNode;for(var m=null;"BODY"!=k.nodeName&&!k.getAttribute("lang");)"P"==k.nodeName&&(m=k),k=k.parentNode;if("BODY"==k.nodeName&&(k=m),k&&(l=k.getAttribute("lang")),l&&f.code3==l)NFLCIME.dispatchEvent({type:"CursorInsertText",target:c,lang:f.code3,text:e.insert,html:n});else if(m&&!m.getAttribute("lang"))m.setAttribute("lang",f.code3),m.setAttribute("class","lang-"+f.code3),m.setAttribute("dir",f.direction),NFLCIME.dispatchEvent({type:"CursorInsertText",target:c,lang:f.code3,text:e.insert,html:n});else{var n="<span ";n+='lang="'+f.code3+'" ',n+='class="lang-'+f.code3+'" ',n+='dir="'+f.direction+'">',n+=e.insert,n+="</span>",NFLCIME.dispatchEvent({type:"CursorInsertHTML",target:c,lang:f.code3,text:e.insert,html:n})}return this.rememberChanges(e),!1}}}},attachDOMHandlers:function(a){this.attachDOMHandler(a.document,"keyup","onKeyUp",!0),this.attachDOMHandler(a.document,"keydown","onKeyDown",!0),this.attachDOMHandler(a.document,"keypress","onKeyPress")},detachDOMHandlers:function(a){this.detachDOMHandler(a.document,"keyup","onKeyUp",!0),this.detachDOMHandler(a.document,"keydown","onKeyDown",!0),this.detachDOMHandler(a.document,"keypress","onKeyPress")},attachDOMHandler:function(a,b,c,d){var e=this[c],f=this.closures[c];if(!f){var g=this;switch(this.browser){case"ie":f=function(a){a.target||(a.target=a.srcElement),a.returnValue=e.call(g,a)};break;case"firefox":case"safari":f=function(a){var b=e.call(g,a);void 0!==b&&b===!1&&a.preventDefault()}}this.closures[c]=f}switch(this.browser){case"ie":a.attachEvent("on"+b,f);break;case"firefox":case"safari":a.addEventListener(b,f,!!d)}},detachDOMHandler:function(a,b,c,d){var e=this.closures[c];if(e)switch(this.browser){case"ie":a.detachEvent("on"+b,e);break;case"firefox":case"safari":a.removeEventListener(b,e,!!d)}},getFocusedEdit:function(){var a={type:"CursorGetFocusedEdit",target:null};return NFLCIME.dispatchEvent(a),a.target},isServiceApplicable:function(a){var b={type:"ServiceApplicable",target:a,service:"kb",applicable:!1};return NFLCIME.dispatchEvent(b),b.applicable},clearVirtualKeys:function(a){this.virtualKeyboardStates.altKey=!1,this.virtualKeyboardStates.ctrlKey=!1,this.virtualKeyboardStates.shiftKey=!1,a&&(this.virtualKeyboardStates.capsLock=!1),this.dispatchKeyboardStateChangeEvent()},dispatchKeyboardStateChangeEvent:function(){var a={altKey:this.combinedKeyboardStates.altKey,ctrlKey:this.combinedKeyboardStates.ctrlKey,shiftKey:this.combinedKeyboardStates.shiftKey,capsLock:this.combinedKeyboardStates.capsLock};this.combinedKeyboardStates.altKey=this.physicalKeyboardStates.altKey||this.virtualKeyboardStates.altKey,this.combinedKeyboardStates.ctrlKey=this.physicalKeyboardStates.ctrlKey||this.virtualKeyboardStates.ctrlKey,this.combinedKeyboardStates.shiftKey=this.physicalKeyboardStates.shiftKey||this.virtualKeyboardStates.shiftKey,this.combinedKeyboardStates.capsLock=this.physicalKeyboardStates.capsLock||this.virtualKeyboardStates.capsLock;var b=this.combinedKeyboardStates;if(a.altKey!=b.altKey||a.ctrlKey!=b.ctrlKey||a.shiftKey!=b.shiftKey||a.capsLock!=b.capsLock){var c="";b.altKey&&(c+="Alt"),b.capsLock&&(c+="Capslock"),b.ctrlKey&&(c+="Ctrl"),b.shiftKey&&(c+="Shift"),this[c]||(-1!=c.indexOf("Capslock")&&(c=-1!=c.indexOf("Shift")?c.replace("Capslock","").replace("Shift",""):c.replace("Capslock","")+"Shift"),""===c&&(c="Normal")),this.combinedKeyboardStates.plane=c,NFLCIME.dispatchEvent({type:"KeyboardStatesChanged"})}},translateKey:function(a){switch(a){case 59:a=186;break;case 107:a=187;break;case 109:a=189}return a},getKeyMappings:function(){return this["map"+this.combinedKeyboardStates.plane]},lookUpKey:function(a,b){var c={insert:"",context:"",isMultikey:!1},d=this.getKeyMappings(),e=d[a];return d&&void 0!==e?(e instanceof Object?(c.insert=e.insert,c.context=e.context):(c.insert=e,c.context=e),this.multikeyCombinations&&(e=this.multikeyCombinations[b+c.context],void 0!==e?(c.isMultikey=!0,e instanceof Object?(c.insert=e.insert,c.context=e.context):(c.insert=e,c.context=e)):this.multikeyNoMatch&&(e=this.multikeyNoMatch[c.context],void 0!==e&&(c.isMultikey=!0,e instanceof Object?(c.insert=e.insert,c.context=e.context):(c.insert=e,c.context=e)))),c):void 0},determineChanges:function(a,b){var c={cursorStart:0,cursorEnd:0,insert:"",context:""},d=this.lookUpKey(b,this.currentContext);return d?(c.insert=d.insert,c.context=d.context,d.isMultikey?c.insert&&(c.cursorStart=-this.lastInsertion.length):!this.lastInsertion&&this.currentContext&&(" "==d.insert?c.insert=this.currentContext:c.insert=this.currentContext+d.insert,c.context=""),c):void 0},rememberChanges:function(a){this.lastInsertion=a.insert,this.currentContext=a.context},clearContext:function(){this.currentContext="",this.lastInsertion=""},initialize:function(a,b){this.browser=a.browser,this.closures={},this.active=!1,"keyboard layout"==this.type&&(NFLCIME.addEventListener("ModuleActivate",this),NFLCIME.addEventListener("ModuleDeactivate",this)),b||NFLCIME.addEventListener("FocusChanged",this)},active:!1,browser:"",physicalKeyboardStates:{capsLock:!1,shiftKey:!1,altKey:!1,ctrlKey:!1},virtualKeyboardStates:{capsLock:!1,shiftKey:!1,altKey:!1,ctrlKey:!1},combinedKeyboardStates:{capsLock:!1,shiftKey:!1,altKey:!1,ctrlKey:!1,plane:"Normal"},closures:null,lastInsertion:"",keyCode:0,capsLockPressed:!1,currentContext:""}}),NFLCIME.dispatchEvent({type:"ModuleAdd",module:{id:"rt",type:"core",dependency:["cursor"],onModuleActivate:function(a){var b=a.module;b!=this||this.active||(this.active=!0,NFLCIME.addEventListener("FocusChanged",this),NFLCIME.addEventListener("RichTextRetrieve",this),NFLCIME.addEventListener("RichTextTransfer",this),NFLCIME.addEventListener("RichTextRetrieveHTML",this),NFLCIME.addEventListener("CursorMoved",this,!0),a={type:"CursorGetFocusedEdit",target:null},NFLCIME.dispatchEvent(a),a.target&&this.attachDOMHandler(a.target,"paste","onPaste"))},onModuleDeactivate:function(a){var b=a.module;b==this&&this.active&&(NFLCIME.removeEventListener("FocusChanged",this),NFLCIME.removeEventListener("RichTextRetrieve",this),NFLCIME.removeEventListener("RichTextRetrieveHTML",this),NFLCIME.removeEventListener("CursorMoved",this,!0),a={type:"CursorGetFocusedEdit",target:null},NFLCIME.dispatchEvent(a),a.target&&this.detachDOMHandler(a.target,"paste","onPaste"))},onRichTextRetrieve:function(a){var b=a.target,c=this.retrieveTextAndStyle(b);return a.textSegments.push.apply(a.textSegments,c),!0},onRichTextRetrieveHTML:function(a){var b=a.target,c=this.retrieveTextAndStyle(b);return a.forPaste&&NFLCIME.dispatchEvent({type:"RichTextPaste",target:a.pasteDestination,textSegments:c}),a.html=this.getHTMLFromTextSegments(c),!0},onCursorMoved:function(a){return this.isPasting?!1:void 0},onPaste:function(a){var b=this.getFocusedEdit();if(b){if(b.className.indexOf("mce-content-body")>=0)return!0;if(this.isServiceApplicable(b))switch(this.isPasting=!0,this.browser){case"ie":var c=b.ownerDocument,d=this.createPasteDestination(c);document.body.appendChild(d);var e=document.body.createTextRange();e.moveToElementText(d),e.execCommand("paste"),d.contentEditable=!1,d.style.display="none",this.pasteTrueTarget=b,this.pasteDestination=d,this.onPasteComplete();break;case"firefox":if("TEXTAREA"==b.tagName||"INPUT"==b.tagName)this.selectionBeforePaste={fromBeginning:b.selectionStart,fromEnd:b.value.length-b.selectionEnd},this.pasteTrueTarget=b,this.pasteDestination=b,this.onPasteComplete(!0);else{var c=b.ownerDocument,f=c.defaultView,g=f.getSelection(),h=g.getRangeAt(0);h.deleteContents();var d=this.createPasteDestination(c);h.insertNode(d),h.selectNodeContents(d),this.pasteTrueTarget=b,this.pasteDestination=d,this.onPasteComplete(!0)}break;case"safari":if("TEXTAREA"!=b.tagName&&"INPUT"!=b.tagName){var i=a.clipboardData.getData("text/plain"),c=b.ownerDocument,f=c.defaultView,g=f.getSelection(),h=g.getRangeAt(0),j=h.startContainer.parentNode,k="";if(tinyMCE&&tinyMCE.activeEditor.language&&(k=tinyMCE.activeEditor.language),j.getAttribute("lang")&&j.getAttribute("lang")==k){var l=document.createTextNode(i);return h.deleteContents(),h.insertNode(l),!1}return NFLCIME.dispatchEvent({type:"CursorInsertHTML",target:b,text:i,html:i}),!1}this.selectionBeforePaste={fromBeginning:b.selectionStart,
fromEnd:b.value.length-b.selectionEnd},this.pasteTrueTarget=b,this.pasteDestination=b,this.onPasteComplete(!0)}}},onPasteComplete:function(a){if(a){var b=this.closures.onPasteComplete;if(!b){var c=this;b=function(){c.onPasteComplete()},this.closures.onPasteComplete=b}return void setTimeout(b,0)}var d,e=this.pasteTrueTarget,f=this.pasteDestination,g=e.ownerDocument;if("TEXTAREA"==f.tagName||"INPUT"==f.tagName){var h=this.selectionBeforePaste,i=e.value,j=i.substring(h.fromBeginning,i.length-h.fromEnd);e.value=i.substr(0,h.fromBeginning)+i.substr(i.length-h.fromEnd),e.setSelectionRange(h.fromBeginning,h.fromBeginning),d=[{lang:"",text:j,style:{fontFamily:"",fontSize:"12pt",fontWeight:400,fontStyle:"normal",color:"#000000",backgroundColor:null,textDecoration:"none"}}]}else switch(this.browser){case"ie":case"firefox":f.parentElement!=g.body&&g.body.appendChild(f),d=this.retrieveTextAndStyle(f),g.body.removeChild(f),f.innerHTML="";break;case"safari":var k=g.defaultView,l=k.getSelection();d=this.retrieveTextAndStyle(e);var m=g.createRange();m.setStart(e,0),m.setEnd(e,e.childNodes.length),m.deleteContents(),m.setStart(e,0),m.setEnd(e,0);var n=this.fragmentBehindCursor.lastChild,o=1;n||(n=this.fragmentAheadOfCursor.firstChild,o=0),m.insertNode(this.fragmentAheadOfCursor),m.insertNode(this.fragmentBehindCursor),l.collapse(n,3==n.nodeType?n.nodeValue.length:1)}NFLCIME.dispatchEvent({type:"RichTextPaste",target:e,textSegments:d});var p=this.getHTMLFromTextSegments(d),q=this.getPlainTextFromTextSegments(d);NFLCIME.dispatchEvent({type:"CursorInsertHTML",target:e,text:q,html:p}),this.isPasting=!1},onFocusChanged:function(a){var b=a.target,c=a.previousTarget;c&&this.detachDOMHandler(c,"paste","onPaste"),b&&this.attachDOMHandler(b,"paste","onPaste")},attachDOMHandler:function(a,b,c,d){var e=this[c],f=this.closures[c];if(!f){var g=this;switch(this.browser){case"ie":f=function(a){a.target||(a.target=a.srcElement),a.returnValue=e.call(g,a)};break;case"firefox":case"safari":f=function(a){var b=e.call(g,a);void 0!==b&&b===!1&&a.preventDefault()}}this.closures[c]=f}switch(this.browser){case"ie":a.attachEvent("on"+b,f);break;case"firefox":case"safari":a.addEventListener(b,f,!!d)}},detachDOMHandler:function(a,b,c,d){var e=this.closures[c];if(e)switch(this.browser){case"ie":a.detachEvent("on"+b,e);break;case"firefox":case"safari":a.removeEventListener(b,e,!!d)}},isServiceApplicable:function(a){var b={type:"ServiceApplicable",target:a,service:"rt",applicable:!1};return NFLCIME.dispatchEvent(b),b.applicable},isSameStyle:function(a,b){var c=["fontFamily","fontSize","fontWeight","fontStyle","textDecoration","color","backgroundColor","direction","verticalAlign"];if(!b||!a)return!1;if(a==b)return!0;for(var d=0;d<c.length;d++){var e=c[d];if(a[e]!=b[e])return!1}return!0},getLegacySizeHash:function(a){var b=this.legacyPointSizesHash[a];if(!b){for(var c=[],d=1;7>=d;d++){var e=document.createElement("FONT");e.innerHTML="HELLO",e.face=e,e.size=d,e.style.visibility="hidden",e.style.position="absolute",document.body.appendChild(e),c[d]=e.offsetHeight,document.body.removeChild(e)}for(var f=[],d=1;128>=d;d++){var e=document.createElement("FONT");if(e.innerHTML="HELLO",e.style.fontFamily=e,e.style.fontSize=d+"pt",e.style.visibility="hidden",e.style.position="absolute",document.body.appendChild(e),f[d]=e.offsetHeight,document.body.removeChild(e),f[d]>c[7])break}b=[];for(var d=1;7>=d;d++)for(var g=c[d],h=8e3,i=1;i<=f.length-1;i++){var j=f[i];if(j==g)b[d]=i;else if(j>g){if(Math.abs(g-h)<Math.abs(g-j)){b[d]=i-1;break}b[d]=i;break}h=j}this.legacyPointSizesHash[a]=b}return b},findLegacySize:function(a,b){var c=this.getLegacySizeHash(a);b=parseInt(b);for(var d=1;7>=d;d++){var e=c[d];if(e==b)return d;if(e>b&&d>1)return d-1}return 7},getLegacyPointSize:function(a,b){var c=this.getLegacySizeHash(a);return(1>b||b>7)&&(b=3),c[b]},getComputedStyle:function(a){var b=a.currentStyle;return b||(b=getComputedStyle(a,"")),b},parseFontFamily:function(a){list=a.split(/\s*,\s*/);var b=list[0];return b.replace(/\s*["']\s*(.*)\s*["']\s*/,"$1")},parseFontSize:function(a,b,c){if(/^\d+\s*pt$/.test(a))return a;if(/^\+?\d+$/.test(a))return this.getLegacyPointSize(b,parseInt(a))+"pt";if(/^\d+\s*%$/.test(a))return Math.round(parseFloat(a)/100*parseFloat(c),1)+"pt";if(/^[\d\.]+\s*px$/.test(a))return Math.round(72*parseFloat(a)/96,1)+"pt";if(/^[\d\.]+\s*em$/.test(a))return Math.round(11*parseFloat(a),1)+"pt";if(/^[a-z-]+$/.test(a)){if("inherit"==a)return c;var d;switch(a){case"xx-small":d=1;break;case"x-small":d=2;break;case"small":d=3;break;case"medium":d=4;break;case"large":d=5;break;case"x-large":d=6;break;case"xx-large":d=7;break;case"larger":d=Math.min(7,this.findLegacySize(parseInt(c))+1);break;case"smaller":d=Math.max(1,this.findLegacySize(parseInt(c))-1)}d&&(c=this.getLegacyPointSize(b,d)+"pt")}return c},parseColor:function(a,b){if("#"==a.charAt(0))return a.toUpperCase();if("inherited"==a)return b;var c;if((c=/RGB\((.+)\)/i.exec(a))||(c=/RGBA\((.+)\)/i.exec(a))){var d=c[1].split(/\s*,\s*/),e="#",f=parseFloat(d[3]);if(isNaN(f)&&(f=1),0===f)return null;for(var g=0;3>g;g++){var h;h=/^\d+\s*%/.test(d[g])?Math.round(255*parseInt(d[g])/100):/^[\d\.]+$/.test(d[g])?Math.min(parseInt(d[g]),255):0;for(var i=h.toString(16);i.length<2;)i="0"+i;e+=i}return e.toUpperCase()}var j=this.htmlColors[a];return j?j:null},convertStyle:function(a,b,c){var d={};return d.fontFamily=this.parseFontFamily(b.fontFamily),d.fontSize=this.parseFontSize(b.fontSize,d.fontFamily,c?c.fontSize:"12pt"),d.fontWeight="bold"==b.fontWeight||b.fontWeight>400?700:400,d.fontStyle=b.fontStyle,"A"==a.tagName&&a.href?d.color=c.color:d.color=this.parseColor(b.color),"#000000"==d.color&&(d.color=null),d.backgroundColor=this.parseColor(b.backgroundColor),"#FFFFFF"==d.backgroundColor&&(d.backgroundColor=null),d.textDecoration=b.textDecoration,"none"==d.textDecoration&&c&&(d.textDecoration=c.textDecoration),d.direction=b.direction,d.verticalAlign=b.verticalAlign,d},retrieveTextAndStyle:function(a){for(var b=this.getComputedStyle(a),c=this.convertStyle(a,b),d="",e=this.retrieveTextAndStyleRecursive(a,c,d),f=[],g=null,h=null,i=null,j=0,k=e.length;k>j;j++){var l=e[j];this.isSameStyle(l.style,g)&&l.lang==i?h+=l.text:(h&&f.push({style:g,text:h,lang:i}),g=l.style,h=l.text,i=l.lang)}return h&&f.push({style:g,text:h,lang:i}),f},retrieveTextAndStyleRecursive:function(a,b,c,d){var e=[];switch(a.tagName){case"BR":e.push({style:b,text:"\n",lang:c})}switch(this.browser){case"ie":if(a.canHaveChildren){var f=a.children,g=f.length,h=a.getAdjacentText("afterBegin");h&&e.push({style:b,text:h,lang:c});for(var i=!1,j=0;g>j;j++){var k=f[j],l=this.getComputedStyle(k);if("none"!=l.display){var m=this.convertStyle(k,l,b),n="block"==l.display,o=k.lang;o||(o=k.getAttribute("mso-ansi-language")),o=o?o.toLowerCase():c;var p=this.retrieveTextAndStyleRecursive(k,m,o);p.length>0&&((i||n)&&e.push({style:m,text:"\n",lang:o}),e=e.concat(p)),i=n}h=k.getAdjacentText("afterEnd"),h&&e.push({style:b,text:h,lang:c})}}break;case"firefox":case"safari":for(var i=!1,k=a.firstChild;k;k=k.nextSibling)if(1==k.nodeType){var l=this.getComputedStyle(k);if("none"!=l.display){var m=this.convertStyle(k,l,b),n="block"==l.display,o=k.lang?k.lang.toLowerCase():c,p=this.retrieveTextAndStyleRecursive(k,m,o,!n);p.length>0&&((i||n&&e.length>0)&&e.push({style:m,text:"\n",lang:o}),e.push.apply(e,p)),i=n}}else if(3==k.nodeType){var h=k.nodeValue;d||0!==e.length||(h=h.replace(/^\s+/,"")),h=h.replace(/[\r\n\s]+/g," "),h&&e.push({style:b,text:h,lang:c}),i=!1}}return e},addTextSegments:function(a,b){for(var c=null,d=0;d<b.length;d++)for(var e=b[d],f=e.text.split("\n"),g=0;g<f.length;g++){var h=f[g];if((!c||g>0)&&(c=document.createElement("P"),e.style.direction&&(c.style.direction=e.style.direction),a.appendChild(c)),h.length>0){var i=[],j=document.createElement("SPAN");e.style&&("underline"==e.style.textDecoration?i.push(document.createElement("U")):"line-through"==e.style.textDecoration&&i.push(document.createElement("S")),"italic"==e.style.fontStyle&&i.push(document.createElement("EM")),e.style.fontWeight>=700&&i.push(document.createElement("STRONG")),"super"==e.style.verticalAlign?i.push(document.createElement("SUP")):"sub"==e.style.verticalAlign&&i.push(document.createElement("SUB")));var j=document.createElement("SPAN");e.style&&(e.style.fontFamily&&(j.style.fontFamily=e.style.fontFamily),e.style.fontSize&&(j.style.fontSize=e.style.fontSize),e.style.color&&(j.style.color=e.style.color),e.style.backgroundColor&&(j.style.backgroundColor=e.style.backgroundColor)),e.className&&(j.className=e.className),e.lang&&(j.lang=e.lang),i.push(j);var k=i[i.length-1];switch(this.browser){case"ie":k.innerText=h;break;case"firefox":case"safari":k.textContent=h}for(var l=i.length-1,m=l-1;m>=0;l--,m--)i[m].appendChild(i[l]);c.appendChild(i[0])}}},getHTMLFromTextSegments:function(a){var b=document.createElement("DIV");return this.addTextSegments(b,a),b.innerHTML},getPlainTextFromTextSegments:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push(d.text)}return b.join("")},getFocusedEdit:function(){var a={type:"CursorGetFocusedEdit",target:null};return NFLCIME.dispatchEvent(a),a.target},createPasteDestination:function(a){var b=null;switch(this.browser){case"ie":var b=a.createElement("DIV");return b.contentEditable=!0,b.style.position="absolute",b.style.height="1px",b.style.width="1px",b.style.right="0px",b.style.top="0px",b.style.border="0px",b.style.overflow="scroll",b.style.whiteSpace="nowrap",b;case"firefox":return b=a.createElement("DIV"),b.style.display="none",b.style.height="1em",b}return b},removePasteDestination:function(){this.pasteDestination&&(document.body.removeChild(this.pasteDestination),this.pasteDestination=null)},initialize:function(a){this.browser=a.browser,this.closures={},NFLCIME.addEventListener("ModuleActivate",this),NFLCIME.addEventListener("ModuleDeactivate",this)},active:!1,browser:"",pasteDestination:null,pasteTrueTarget:null,selectionBeforePaste:null,fragmentBehindCursor:null,fragmentAheadOfCursor:null,isPasting:!1,legacyPointSizesHash:{},htmlColors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}}}),NFLCIME.dispatchEvent({type:"ModuleAdd",module:{id:"rt.scrube",type:"util",dependency:["rt"],onModuleActivate:function(a){var b=a.module;b!=this||this.active||(this.active=!0,NFLCIME.addEventListener("RichTextPaste",this))},onModuleDeactivate:function(a){var b=a.module;b==this&&this.active&&NFLCIME.removeEventListener("RichTextPaste",this)},onRichTextPaste:function(a){for(var b=a.textSegments,c=0;c<b.length;c++){var d=b[c];/(^|,)wingdings($|,)/i.test(d.style.fontFamily)?d.text=this.convertSymbols(d.text,this.wingdingTable):/(^|,)wingdings 2($|,)/i.test(d.style.fontFamily)?d.text=this.convertSymbols(d.text,this.wingding2Table):/(^|,)symbol($|,)/i.test(d.style.fontFamily)&&(d.text=this.convertSymbols(d.text,this.symbolTable)),d.style.fontFamily=void 0,d.style.fontSize=void 0;var a={type:"LanguageDetect",textSegment:d,languageTag:"",code2:"",code3:"",script:""};NFLCIME.dispatchEvent(a);var e=a.languageTag||a.code3||a.code2,f=(a.script,a.direction);e?(d.style.direction=f,d.lang=""):(d.style.direction="ltr",d.lang="eng")}},convertSymbols:function(a,b){for(var c="",d=0;d<a.length;d++){var e=a.charAt(d),f=b[e];f||(f=" "==e?" ":"?"),c+=f}return c},initialize:function(a){this.browser=a.browser,this.closures={},NFLCIME.addEventListener("ModuleActivate",this),NFLCIME.addEventListener("ModuleDeactivate",this)},active:!1,wingdingTable:{"!":"✏",'"':"✂","#":"✁","(":"☎",")":"✆","*":"✉",6:"⌛",7:"⌨",">":"✇","?":"✍",A:"✌",E:"☜",F:"☞",G:"☝",H:"☟",J:"☺",L:"☹",N:"☠",O:"⚐",Q:"✈",R:"☼",T:"❄",V:"✞",X:"✠",Y:"✡",Z:"☪","[":"☯","\\":"ॐ","]":"☸","^":"♈",_:"♉","`":"♊",a:"♋",b:"♌",c:"♍",d:"♎",e:"♏",f:"♐",g:"♑",h:"♒",i:"♓",j:"&",k:"&",l:"●",m:"❍",n:"■",o:"□",q:"❑",r:"❒",s:"⬧",t:"⧫",u:"◆",v:"❖",w:"⬥",x:"⌧",y:"⍓",z:"⌘","{":"❀","|":"✿","}":"❝","~":"❞","":"▯","":"⓪","":"①","":"②","":"③","":"④","":"⑤","":"⑥","":"⑦","":"⑧","":"⑨","":"⑩","":"⓿","":"❶","":"❷","":"❸","":"❹","":"❺","":"❻","":"❼","":"❽","":"❾","":"❿","":"·","":"•"," ":"▪","¡":"○","¤":"◉","¥":"◎","§":"▪","¨":"◻","ª":"✦","«":"★","¬":"✶","­":"✴","®":"✹","¯":"✵","±":"⌖","²":"⟡","³":"⌑","µ":"✪","¶":"✰","Õ":"⌫","Ö":"⌦","Ø":"➢","Ü":"➲","è":"➔","ï":"⇦","ð":"⇨","ñ":"⇧","ò":"⇩","ó":"⬄","ô":"⇳","õ":"⬀","ö":"⬁","÷":"⬃","ø":"⬂","ù":"▭","ú":"▫","û":"✗","ü":"✓","ý":"☒","þ":"☑"},wingding2Table:{"%":"✄","'":"☏",">":"☜","?":"☞","@":"☚",A:"☛",F:"☝",G:"☟",O:"✗",P:"✓",R:"☑",S:"☒",T:"☒",U:"⌔",V:"⌔",W:"⦸",X:"⦸",Y:"&",Z:"&","[":"&","\\":"&","]":"‽","^":"‽",_:"‽","`":"‽",i:"⓪",j:"①",k:"②",l:"③",m:"④",n:"⑤",o:"⑥",p:"⑦",q:"⑧",r:"⑨",s:"⑩",t:"⓿",u:"❶",v:"❷",w:"❸",x:"❹",y:"❺",z:"❻","{":"❼","|":"❽","}":"❾","~":"❿","":"☉","":"◯","":"☽","":"☾","":"✝","":"✝","":"•","":"⚫","":"●","":"⬤","":"○","":"⦿","":"■"," ":"◾","¡":"◼","¢":"⬛","£":"⬜","¬":"⬩","­":"⬥","®":"◆","¯":"◇","²":"◈","µ":"⬪","¶":"⬧","·":"⧫","¸":"◊","º":"◖","»":"◗","¾":"◼","¿":"⬥","À":"⬟","Â":"⬣","Ã":"⬢","Æ":"+","Ç":"+","Ì":"✚","Í":"☓","Ð":"✕","Ó":"✖","Þ":"✱","è":"✦","ê":"★","ë":"✶","í":"✷","ð":"✹","ó":"✯","ø":"※","ù":"⁂"},symbolTable:{'"':"∀",$:"∃","'":"∍","*":"∗","-":"−","@":"≅","\\":"∴","^":"⊥","~":"∼","¡":"ϒ","¢":"′","£":"≤","¤":"⁄","¥":"∞","¦":"ƒ","§":"♣","¨":"♦","©":"♥","ª":"♠","«":"↔","¬":"←","­":"↑","®":"→","¯":"↓","²":"″","³":"≥","´":"×","µ":"∝","¶":"∂","·":"∙","¸":"÷","¹":"≠","º":"≡","»":"≈","¼":"…","½":"⏐","¾":"⎯","¿":"↵","À":"ℵ","Á":"ℑ","Â":"ℜ","Ã":"℘","Ä":"⊗","Å":"⊕","Æ":"∅","Ç":"∩","È":"∪","É":"⊃","Ê":"⊇","Ë":"⊄","Ì":"⊂","Í":"⊆","Î":"∈","Ï":"∉","Ð":"∠","Ñ":"∇","Ò":"®","Ó":"©","Ô":"™","Õ":"∏","Ö":"√","×":"⋅","Ø":"¬","Ù":"∧","Ú":"∨","Û":"⇔","Ü":"⇐","Ý":"⇑","Þ":"⇒","ß":"⇓","à":"◊","á":"〈","â":"®","ã":"©","ä":"™","å":"∑","æ":"⎛","ç":"⎜","è":"⎝","é":"⎡","ê":"⎢","ë":"⎣","ì":"⎧","í":"⎨","î":"⎩","ï":"⎪","ð":"€","ñ":"〉","ò":"∫","ó":"⌠","ô":"⎮","õ":"⌡","ö":"⎞","÷":"⎟","ø":"⎠","ù":"⎤","ú":"⎥","û":"⎦","ü":"⎫","ý":"⎬","þ":"⎭",A:"Α",a:"α",B:"Β",b:"β",C:"Χ",c:"χ",D:"Δ",d:"δ",E:"Ε",e:"ε",F:"Φ",f:"φ",G:"Γ",g:"γ",H:"Η",h:"η",I:"Ι",i:"ι",J:"ϑ",j:"ϕ",K:"Κ",k:"κ",L:"Λ",l:"λ",M:"Μ",m:"μ",N:"Ν",n:"ν",O:"Ο",o:"ο",P:"Π",p:"π",Q:"Θ",q:"θ",R:"Ρ",r:"ρ",S:"Σ",s:"σ",T:"Τ",t:"τ",U:"Υ",u:"υ",V:"ς",v:"ϖ",W:"Ω",w:"ω",X:"Ξ",x:"ξ",Y:"Ψ",y:"ψ",Z:"Ζ",z:"ζ"}}}),NFLCIME.dispatchEvent({type:"ModuleAdd",module:{id:"lang",type:"language",dependency:["cursor"],onModuleActivate:function(a){var b=a.module;b==this?(NFLCIME.addEventListener("FocusChanged",this),NFLCIME.addEventListener("CursorMoved",this),NFLCIME.addEventListener("LanguageRescan",this),NFLCIME.addEventListener("LanguageChange",this),NFLCIME.addEventListener("LanguageGet",this),NFLCIME.addEventListener("LanguageDetect",this),NFLCIME.addEventListener("LanguageSetHint",this),NFLCIME.addEventListener("OptionSet",this),NFLCIME.addEventListener("OptionGet",this)):"keyboard layout"==b.type?(this.keyboard=b,this.launchKeyboardInterface()):"encoding converter"==b.type?(this.converter=b,this.launchConverterInterface()):"ui.kb"==b.id?this.keyboardInterface=b:"ui.cvt"==b.id?this.converterInterface=b:"ui.lang"==b.id&&(this.languageInterface=b)},onModuleDeactivate:function(a){var b=a.module;b==this?(NFLCIME.removeEventListener("FocusChanged",this),NFLCIME.removeEventListener("CursorMoved",this),NFLCIME.removeEventListener("LanguageRescan",this),NFLCIME.removeEventListener("LanguageChange",this),NFLCIME.removeEventListener("LanguageDetect",this),NFLCIME.removeEventListener("LanguageGet",this),NFLCIME.removeEventListener("LanguageSetHint",this),NFLCIME.removeEventListener("OptionSet",this),NFLCIME.removeEventListener("OptionGet",this)):b==this.keyboard?(this.keyboard=null,this.keyboardInterface&&NFLCIME.dispatchEvent({type:"ModuleDeactivate",module:this.keyboardInterface,animation:"fade-out"})):b==this.converter?(this.converter=null,this.converterInterface&&NFLCIME.dispatchEvent({type:"ModuleDeactivate",module:this.converterInterface,animation:"fade-out"})):b==this.keyboardInterface?this.keyboardInterface=null:b==this.converterInterface?this.converterInterface=null:b==this.languageInterface&&(this.languageInterface=null)},onFocusChanged:function(a){this.onCursorMoved(a)},onCursorMoved:function(a){var b=a.target,a={type:"ServiceApplicable",target:b,service:"kb,cvt",applicable:!1};NFLCIME.dispatchEvent(a);var c=a.applicable?this.getLangTag(b):"null";if(this.languageTag!=c){var d="null"==c||"unknown"==c?"":(d=this.findLanguageByIETFTag(c))&&d.direction;NFLCIME.dispatchEvent({type:"LanguageChange",languageTag:c,languageDir:d})}},onLanguageRescan:function(a){var a={type:"CursorGetFocusedEdit",target:null};NFLCIME.dispatchEvent(a),this.onFocusChanged(a)},onLanguageChange:function(a){var b=a.languageTag,c=this.findLanguageByIETFTag(b);this.language!=c&&(this.language=c,this.language?(this.keyboardId=this.getPreference("kb","id",this.language.id),this.keyboardShow=this.getPreferenceBoolean("kb","show",this.language.id),this.converterId=this.getPreference("cvt","id",this.language.id)):(this.keyboardId=null,this.converterId=null),this.launchLanguageInterface(),this.launchKeyboard(),this.launchConverter())},onLanguageGet:function(a){if(this.language){if(a.languageTag=this.languageTag,this.language.twoLetterISO)a.code2=this.language.twoLetterISO;else if(this.language.threeLetterISO){var b=this.findMacroLanguageByThreeLetterCode(this.language.threeLetterISO);b&&(a.code2=b.twoLetterISO)}this.language.threeLetterISO&&(a.code3=this.language.threeLetterISO),a.script=this.language.script,a.direction=this.language.direction}},onLanguageSetHint:function(a){this.languageHint=a.languageTag},onLanguageDetect:function(a){var b=a.textSegment,c=null,d=null;if(!(b.style&&b.style.fontFamily&&/symbol|wingding|webding/i.test(b.style.fontFamily))){if(this.languageHint){var e=this.findLanguageByIETFTag(this.languageHint);e&&this.matchTextSegmentToLanguage(b,e)&&(c=e,d=this.languageHint)}if(!c&&this.language&&this.matchTextSegmentToLanguage(b,this.language)&&(c=this.language,d=this.languageTag),!c&&b.lang&&(c=this.findLanguageByIETFTag(b.lang),c&&(d=c.fullTag)),!c)for(var f=this.getEnglishCharacterCount(b.text),g=0;g<this.languages.length;g++){var h=this.languages[g],i=this.getLanguageCharacterCount(b.text,h,!1);i>f&&(c=h,d=h.fullTag,f=i)}if(c){if(d&&(a.languageTag=d),c.twoLetterISO)a.code2=c.twoLetterISO;else if(c.threeLetterISO){var j=this.findMacroLanguageByThreeLetterCode(c.threeLetterISO);j&&j.twoLetterISO&&(a.code2=j.twoLetterISO)}if(c.threeLetterISO&&(a.code3=c.threeLetterISO),c.script)a.script=c.script,a.direction=c.direction;else{var k=0,l=null;if(c.variants)for(var m=b.text,g=0;g<c.variants.length;g++){var n=c.variants[g],o=this.findLanguageByIETFTag(n);if(o){var i=this.getLanguageCharacterCount(m,o,!1);i>k&&(k=i,l=o)}}l?(a.script=l.script,a.direction=l.direction):(a.script="",a.direction="")}}}},onOptionSet:function(a){var b=a.name,c=a.value;switch(b){case"use-keyboard":this.keyboardEnabled!=c&&(this.keyboardEnabled=c,this.launchKeyboard(),this.savePreference("kb","enabled",null,this.keyboardEnabled));break;case"keyboard-id":this.keyboardId!=c&&(this.keyboardId=c,this.launchKeyboard(),this.language&&this.savePreference("kb","id",this.language.id,this.keyboardId));break;case"show-keyboard":this.keyboardShow!=c&&(this.keyboardShow=c,this.launchKeyboardInterface(),this.language&&this.savePreference("kb","show",this.language.id,this.keyboardShow));break;case"use-converter":this.converterEnabled!=c&&(this.converterEnabled=c,this.launchConverter(),this.savePreference("cvt","enabled",null,this.converterEnabled));break;case"converter-id":this.converterId!=c&&(this.converterId=c,this.launchConverter(),this.language&&this.savePreference("cvt","id",this.language.id,this.converterId))}},onOptionGet:function(a){var b=a.name;switch(b){case"use-keyboard":a.value=this.keyboardEnabled;break;case"keyboard-id":a.value=this.keyboardId;break;case"show-keyboard":a.value=this.keyboardShow;break;case"use-converter":a.value=this.converterEnabled;break;case"converter-id":a.value=this.converterId}},getLangTag:function(a){var b={type:"CursorGetContainer",target:a,container:null};NFLCIME.dispatchEvent(b);for(var c=b.container,d=c;d&&1==d.nodeType;d=d.parentNode){var e=d.getAttribute("lang");if(e||(e=d.getAttribute("xml:lang")),e)return e.toLowerCase()}return"unknown"},findLanguageByIETFTag:function(a){for(var b=0,c=this.languages.length;c>b;b++)if(this.languages[b].fullTag==a)return this.languages[b];var d;if(d=/^[a-z]{3}/.exec(a)){var e=this.findLanguageByThreeLetterCode(d[0]);return e||(e=this.findMacroLanguageByThreeLetterCode(d[0])),e}return(d=/^[a-z]{2}/.exec(a))?e=this.findLanguageByTwoLetterCode(d[0]):void 0},findLanguageByTwoLetterCode:function(a){for(var b=0;b<this.languages.length;b++){var c=this.languages[b];if(c.twoLetterISO==a)return c}},findLanguageByThreeLetterCode:function(a){for(var b=0;b<this.languages.length;b++){var c=this.languages[b];if(c.threeLetterISO==a)return c}},findMacroLanguageByThreeLetterCode:function(a){for(var b=0;b<this.languages.length;b++){var c=this.languages[b];if(c.variants)for(var d=0;d<c.variants.length;d++)if(c.variants[d]==a)return c}},getLanguageCharacterCount:function(a,b,c){if(b.characterSet){var d=new RegExp("["+b.characterSet+"]+","g"),e=a.replace(d,"");return a.length-e.length}if(c&&b.variants){for(var f=0,g=0;g<b.variants.length;g++){var h=b.variants[g],i=this.findLanguageByIETFTag(h);if(i){var j=this.getLanguageCharacterCount(a,i,!1);j>f&&(f=j)}}return f}return 0},getEnglishCharacterCount:function(a){var b=a.replace(/[a-zA-Z]+/g,"");return a.length-b.length},matchTextSegmentToLanguage:function(a,b){if(a.lang){var c=a.lang.toLowerCase(),d=this.findLanguageByIETFTag(c);if(d){if(b==d)return!0;if(d.variants)for(var e=b.threeLetterISO,f=0;f<d.variants.length;f++){var g=d.variants[f];if(g==e||g==c)return!0}}}var h=this.getLanguageCharacterCount(a.text,b,!0);return h>0&&h>this.getEnglishCharacterCount(a.text)},launchLanguageInterface:function(){if(this.language&&this.language.kbd){var a="ui.lang."+this.language.id+".html";NFLCIME.dispatchEvent({type:"UIModuleLoad",moduleId:"ui.lang",url:a,options:{hAlign:"left",vAlign:"bottom"}})}else this.languageInterface&&NFLCIME.dispatchEvent({type:"ModuleDeactivate",module:this.languageInterface,animation:"fade-out"})},launchKeyboard:function(){this.keyboardId&&this.keyboardEnabled&&this.language.kbd?NFLCIME.dispatchEvent({type:"ModuleLoad",moduleId:this.keyboardId,activate:!0}):this.keyboard&&NFLCIME.dispatchEvent({type:"ModuleDeactivate",module:this.keyboard})},launchKeyboardInterface:function(){if(this.keyboard&&this.keyboardShow){var a="ui."+this.keyboard.id+".html";NFLCIME.dispatchEvent({type:"UIModuleLoad",moduleId:"ui.kb",url:a,options:{hAlign:"right",vAlign:"top"}})}else this.keyboardInterface&&NFLCIME.dispatchEvent({type:"ModuleDeactivate",module:this.keyboardInterface,animation:"fade-out"})},launchConverter:function(){this.converterId&&this.converterEnabled?NFLCIME.dispatchEvent({type:"ModuleLoad",moduleId:this.converterId,activate:!0}):this.converter&&NFLCIME.dispatchEvent({type:"ModuleDeactivate",module:this.converter})},launchConverterInterface:function(){if(this.converter);},savePreference:function(a,b,c,d){var e=a+(c?"."+c:""),f={type:"PersistenceSetValue",id:e,name:b,value:d};NFLCIME.dispatchEvent(f),this.preference[b+"."+e]=d.toString()},getPreference:function(a,b,c){var d=a+(c?"."+c:""),e=this.preference[b+"."+d];if(void 0!=e)return e;var f={type:"PersistenceGetValue",id:d,name:b};return NFLCIME.dispatchEvent(f),f.value},getPreferenceBoolean:function(a,b,c){var d=this.getPreference(a,b,c);return void 0!=d?"true"==d:void 0},initialize:function(a,b){console.log("lang initializing!");var c=this;this.defaultIETFTag=a.configuration.defaultIETFTag,NFLCIME.addEventListener("ModuleActivate",this),NFLCIME.addEventListener("ModuleDeactivate",this),this.keyboardEnabled=c.getPreferenceBoolean("kb","enabled"),this.converterEnabled=c.getPreferenceBoolean("cvt","enabled");var d=NFLCIME.mapUrlToPackage("languages.json"),e=/^\w+:/.test(d)||/^\//.test(d)?d:a.scriptURLRoot+d,f=new XMLHttpRequest;f.onreadystatechange=function(){4==f.readyState&&200==f.status&&(c.languages=JSON.parse(f.responseText),c.languages.sort(function(a,b){return a.weight==b.weight?0:void 0===a.weight?1:void 0===b.weight?-1:a.weight>b.weight?-1:1}))},f.open("GET",e,!0),f.send()},language:null,languageTag:null,languageHint:null,languageInterface:null,keyboard:null,keyboardId:null,keyboardEnabled:!0,keyboardShow:!0,keyboardInterface:null,converter:null,converterId:null,converterEnabled:!0,converterWindow:!1,converterInterface:null,preference:{},languages:null}});